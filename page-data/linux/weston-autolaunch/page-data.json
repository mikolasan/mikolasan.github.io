{"componentChunkName":"component---src-templates-blog-template-js","path":"/linux/weston-autolaunch","result":{"data":{"markdownRemark":{"html":"<p><strong>Update (May 2022):</strong> Back in June 2021 when I was working on my task and was dissecting Weston, this <a href=\"https://gitlab.freedesktop.org/wayland/weston/-/issues/171\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">feature request</a> was open. But now it's merged to upstream! I'm going to test that out.\n<strong>End of the update</strong></p>\n<hr>\n<p>For example you need to make a kiosk-type system where after automatic login one main application starts <a href=\"/blog/center-window-in-weston\">in the center of the screen</a>. This is where you research about autostart feature.</p>\n<p>According to the <a href=\"https://specifications.freedesktop.org/autostart-spec/autostart-spec-latest.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">official XDG specification</a></p>\n<blockquote>\n<p>By placing an application's .desktop file in one of the Autostart directories the application will be automatically launched during startup of the user's desktop environment after the user has logged in.</p>\n</blockquote>\n<p>Autostart directories can be either <code class=\"language-text\">~/.config/autostart/</code> or <code class=\"language-text\">/etc/xdg/autostart/</code>. This does not work. <a href=\"https://gitlab.freedesktop.org/wayland/weston/-/issues/456\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Maybe it worked</a> in the old version, but I'm using Weston 9.0.0.</p>\n<p>In the following <a href=\"https://gitlab.freedesktop.org/wayland/weston/-/issues/476\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">ticket</a> and <a href=\"https://archlinuxarm.org/forum/viewtopic.php?f=57&#x26;t=15209\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">this forum</a> autostart of graphical application was prepared as systemd service which might work, but only once in a blue moon.</p>\n<p>On <a href=\"https://wiki.parabola.nu/Wayland\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">wiki pages</a> of Parabola OS I found some ideas. I can use <strong>.bash_profile</strong> and <code class=\"language-text\">dbus-run-session</code> to autostart on login</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token environment constant\">$DISPLAY</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token environment constant\">$XDG_VTNR</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> dbus-run-session -- gnome-shell --display-server <span class=\"token parameter variable\">--wayland</span></code></pre></div>\n<p>But docs of <a href=\"https://developer.toradex.com/knowledge-base/how-to-autorun-application-at-the-start-up-in-linux\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Yocto Project</a> gave me more ideas that finally all together turned into one working solution.</p>\n<p>So their version looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># wait for weston</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-e</span>  <span class=\"token environment constant\">$XDG_RUNTIME_DIR</span>/wayland-0 <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token function\">sleep</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span>\n\n/path/to/the/application <span class=\"token operator\">&amp;</span></code></pre></div>\n<p>It can be a systemd service that calls the script as was mentioned earlier. Such service example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[Unit]\nDescription=Start a wayland application\nAfter=weston@root.service\nRequires=weston@root.service\n \n[Service]\nRestart=on-failure\nType=forking\nExecStart=/usr/bin/wayland-app-launch.sh\nRestartSec=1\n\n[Install]\nWantedBy=multi-user.target</code></pre></div>\n<p>Weston service example if needed</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[Unit]\nDescription=Weston Kiosk mode\nAfter=network.target\n\n[Service]\nType=notify\nRuntimeDirectory=weston\nRuntimeDirectoryMode=0755\nEnvironment=\"XDG_RUNTIME_DIR=/run/weston\"\nExecStart=/usr/bin/weston --tty=1 --log=/var/log/runeaudio/weston.log \\\n              --config=/srv/http/.config/weston.ini --modules=systemd-notify.so\nExecStop=/usr/bin/pkill -15 weston\nIgnoreSIGPIPE=no\nStandardOutput=journal\nStandardError=journal\nTimeoutSec=infinity\n\n[Install]\nWantedBy=multi-user.target</code></pre></div>\n<p>But in my case, while I'm using InitV in my <a href=\"/blog/custom-linux\">custom Linux build</a>, this bash script goes to <strong>/etc/init.d/</strong> and has the <code class=\"language-text\">case</code> block around main logic:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Start The Installer....</span>\n<span class=\"token comment\">#</span>\n\n<span class=\"token keyword\">case</span> <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token keyword\">in</span>\n  start<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Starting The Installer...\"</span>\n    <span class=\"token comment\"># writeble dir for weston</span>\n    <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">XDG_RUNTIME_DIR</span></span><span class=\"token operator\">=</span>/tmp/xdg-runtime-dir\n    <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token string\">\"<span class=\"token variable\">${<span class=\"token environment constant\">XDG_RUNTIME_DIR</span>}</span>\"</span>\n    <span class=\"token function\">mkdir</span> <span class=\"token string\">\"<span class=\"token variable\">${<span class=\"token environment constant\">XDG_RUNTIME_DIR</span>}</span>\"</span>\n    <span class=\"token function\">chmod</span> 0700 <span class=\"token string\">\"<span class=\"token variable\">${<span class=\"token environment constant\">XDG_RUNTIME_DIR</span>}</span>\"</span>\n    <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">XDG_CONFIG_HOME</span><span class=\"token operator\">=</span>/root/.config\n    dbus-launch weston <span class=\"token parameter variable\">--tty</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token operator\">&amp;</span>\n    \n    <span class=\"token comment\"># wait for weston</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-e</span> <span class=\"token environment constant\">$XDG_RUNTIME_DIR</span>/wayland-0 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token function\">sleep</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span>\n\n    <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">WAYLAND_DISPLAY</span><span class=\"token operator\">=</span>wayland-0\n    /path/to/some-qt-app <span class=\"token parameter variable\">-platform</span> wayland\n    <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n  stop<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n  restart<span class=\"token operator\">|</span>reload<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n  *<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Usage: <span class=\"token variable\">$0</span> {start|stop|restart}\"</span>\n    <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">esac</span>\n\n<span class=\"token builtin class-name\">exit</span> <span class=\"token variable\">$?</span>\n</code></pre></div>\n<p>This script just waits in the background while Weston is going to be initialized by checking one variable <code class=\"language-text\">$XDG_RUNTIME_DIR/wayland-0</code> and after that it starts the application.</p>","excerpt":"Update (May 2022): Back in June 2021 when I was working on my task and was dissecting Weston, this feature request was open. But now it's…","tableOfContents":"","fields":{"socialcard":"gatsby-plugin-social-card/c4eab2a4-665f-529c-b4f6-63bb69df8c77.jpg"},"frontmatter":{"date":"July 19, 2021","published":"October 14, 2021","lastModified":"May 04, 2022","title":"Weston autolaunch","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/weston-autolaunch.md","url":"/linux/weston-autolaunch","next":{"excerpt":"My fisrt problem was: How to center window in Weston?. My second problem was: Drop shadow effect in Weston The last one is so simple, but I…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/if-not-weston.md","frontmatter":{"title":"If not Weston?","date":"2021-07-30T00:00:00.000Z","topic":null,"article":null},"id":"cb36ca81-ce37-5406-95ee-1780a4902d6b"},"previous":{"excerpt":"If the database resides on a Btrfs file system, you should consider disabling Copy-on-Write for the directory before creating any database…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/important-lesson-about-btrfs.md","frontmatter":{"title":"Important lesson about Btrfs","date":"2021-06-17T00:00:00.000Z","topic":null,"article":null},"id":"6b8b44f7-db18-51f8-8c6e-8cf2a92747d1"},"recentArticles":[{"excerpt":"The time is now. So you are following the official path","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/lunar-vim.md","frontmatter":{"title":"Lunar Vim","date":"2025-07-12T00:00:00.000Z","topic":null,"article":null},"id":"96fd1359-d24f-593f-bfd5-c6ea877b7e1e"},{"excerpt":"Prologue When I changed my email with Asana, the service that I liked so much, I found it when I had trouble planning my day, forgiving…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/task-management-with-taskwarrior.md","frontmatter":{"title":"Task management with taskwarrior","date":"2025-06-19T00:00:00.000Z","topic":null,"article":null},"id":"d251091d-7777-5f57-a398-6317d95233da"},{"excerpt":"I called my pool 'dinosaur' and three datasets, you guessed it, triassic, jurassic, cretaceous Steps: Reference archwiki - zfs zfs handbook…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/encrypted-backup-with-zfs.md","frontmatter":{"title":"Encrypted backup with ZFS","date":"2025-06-10T00:00:00.000Z","topic":null,"article":null},"id":"a8cfe7c2-1870-5a4d-a4b6-a9e5cb56f73b"},{"excerpt":"I already got used to auto-starting services when they run with docker compose or docker stack, but I like it even more when the apps run…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/autostart-everything.md","frontmatter":{"title":"Autostart everything","date":"2025-05-26T00:00:00.000Z","topic":null,"article":null},"id":"7c1cd1ea-fc7f-558a-9576-5f5420866bad"},{"excerpt":"So this happened when I was working on a Go project and quite frequently compiled binaries for deployment in docker containers. I didn't pay…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/clear-space.md","frontmatter":{"title":"Clear space on Linux","date":"2025-04-15T00:00:00.000Z","topic":null,"article":null},"id":"b3347ef2-f534-5c29-bc5e-0ed82ca4c7ee"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}