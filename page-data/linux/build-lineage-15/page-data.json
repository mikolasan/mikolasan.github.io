{"componentChunkName":"component---src-templates-blog-template-js","path":"/linux/build-lineage-15","result":{"data":{"markdownRemark":{"html":"<p>Here is the story of how I started <a href=\"/linux/upgrade-android-on-nvidia-shield\">upgrading Android on my Nvidia Shield tablet</a> because one day I saw a popup in the app, where I read ebooks from my public library, that soon they will drop support of Android 7.</p>\n<h2 id=\"setup-docker\" style=\"position:relative;\">Setup Docker<a href=\"#setup-docker\" aria-label=\"setup docker permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>So I open VirtualBox and blow off dust from my Ubuntu 18 virtual machine. \"Blowing\" means I run <code class=\"language-text\">apt update &amp;&amp; apt upgrade</code>. It's also possible to do everything in a docker container:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--name</span> lineage-build ubuntu:18.04 <span class=\"token function\">bash</span>\n<span class=\"token comment\"># install all stuff in the container</span>\n<span class=\"token comment\"># ...</span>\n<span class=\"token comment\"># use it again next day</span>\n<span class=\"token function\">docker</span> start <span class=\"token parameter variable\">-i</span> lineage-build\n<span class=\"token comment\"># or save as image (very fat image though)</span>\n<span class=\"token function\">docker</span> container <span class=\"token function\">ls</span> <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-s</span> <span class=\"token comment\"># check size (72GB after git clone, 126GB after build)</span>\n<span class=\"token function\">docker</span> commit lineage-build lineagos:15.1\n<span class=\"token comment\"># in case you run `adb` from the docker mount `dev`, open ports</span>\n<span class=\"token function\">docker</span> run <span class=\"token parameter variable\">--tty</span> <span class=\"token parameter variable\">--detached</span> <span class=\"token parameter variable\">--privileged</span> <span class=\"token parameter variable\">--volume</span> /dev/bus/usb:/dev/bus/usb --publish-all <span class=\"token parameter variable\">--name</span> lineage-build-2 lineagos:15.1\n<span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-a</span>\n<span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">--tty</span> <span class=\"token parameter variable\">--interactive</span> d886b12741a8 <span class=\"token function\">bash</span></code></pre></div>\n<p>Then prepare docker a bit</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token function\">sudo</span>\nupdate-alternatives <span class=\"token parameter variable\">--install</span> /usr/bin/python python /usr/bin/python3.6 <span class=\"token number\">1</span> <span class=\"token comment\"># we will switch to Python 2 later</span>\n<span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.email <span class=\"token string\">\"do_not_send_me_spam@gmail.com\"</span>\n<span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.name <span class=\"token string\">\"Nikolay Neupokoev\"</span>\n<span class=\"token function\">sed</span> <span class=\"token string\">\"s/TLSv1, TLSv1.1, //\"</span> <span class=\"token parameter variable\">-i</span> /etc/java-8-openjdk/security/java.security\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">USER</span></span><span class=\"token operator\">=</span>nikolay <span class=\"token comment\"># stupid script from Jack server needs it</span></code></pre></div>\n<p>Then we follow the <a href=\"https://wiki.lineageos.org/devices/shieldtablet/build\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">build instructions</a>. The excerpt.</p>\n<p>Install stuff</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token function\">bc</span> bison build-essential ccache <span class=\"token function\">curl</span> flex g++-multilib gcc-multilib <span class=\"token function\">git</span> git-lfs gnupg gperf imagemagick <span class=\"token punctuation\">\\</span>\n  lib32ncurses5-dev lib32readline-dev lib32z1-dev libelf-dev liblz4-tool libncurses5 libncurses5-dev <span class=\"token punctuation\">\\</span>\n  libsdl1.2-dev libssl-dev libxml2 libxml2-utils lzop pngcrush <span class=\"token function\">rsync</span> <span class=\"token punctuation\">\\</span>\n  schedtool squashfs-tools xsltproc <span class=\"token punctuation\">\\</span>\n  <span class=\"token function\">zip</span> zlib1g-dev <span class=\"token punctuation\">\\</span>\n  libwxgtk3.0-dev <span class=\"token punctuation\">\\</span>\n  openjdk-8-jdk <span class=\"token punctuation\">\\</span>\n  python2.7 <span class=\"token punctuation\">\\</span>\n  <span class=\"token function\">lsof</span>\n\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> <span class=\"token parameter variable\">-o</span> platform-tools.zip https://dl.google.com/android/repository/platform-tools-latest-linux.zip\n<span class=\"token function\">unzip</span> platform-tools.zip <span class=\"token parameter variable\">-d</span> ~\n\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span>  ~/.local/bin\n<span class=\"token function\">curl</span> https://storage.googleapis.com/git-repo-downloads/repo <span class=\"token operator\">></span> ~/.local/bin/repo\n<span class=\"token function\">chmod</span> a+x ~/.local/bin/repo</code></pre></div>\n<p>Set environment variables to make it work and with some build tweaks</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/root/platform-tools:/root/.local/bin:<span class=\"token environment constant\">$PATH</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">USE_CCACHE</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CCACHE_EXEC</span><span class=\"token operator\">=</span>/usr/bin/ccache\nccache <span class=\"token parameter variable\">-M</span> 50G\nccache <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">compression</span><span class=\"token operator\">=</span>true\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ANDROID_JACK_VM_ARGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx4G\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ANDROID_JACK_EXTRA_ARGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"--verbose debug --sanity-checks on -D sched.runner=single-threaded\"</span></code></pre></div>\n<p>Get the repo. Note: you have to <a href=\"https://stackoverflow.com/questions/72547134/repo-init-fails-while-cloning-manifest\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">use local directories</a> owned by your user and not ones mounted into virtual machine from the host that usually have <code class=\"language-text\">root:vboxsf</code> ownership.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /lineage\n<span class=\"token builtin class-name\">cd</span> /lineage\nrepo init <span class=\"token parameter variable\">-u</span> https://github.com/LineageOS/android.git <span class=\"token parameter variable\">-b</span> lineage-15.1 --git-lfs\nrepo <span class=\"token function\">sync</span>\n\n<span class=\"token comment\"># switch to Python 2</span>\nupdate-alternatives <span class=\"token parameter variable\">--install</span> /usr/bin/python python /usr/bin/python2.7 <span class=\"token number\">2</span>\n<span class=\"token builtin class-name\">source</span> build/envsetup.sh\nbreakfast shieldtablet\n\n<span class=\"token comment\"># be careful with this step, it's possible to approach it with 3 different sides</span>\n<span class=\"token builtin class-name\">cd</span> /lineage/device/nvidia/shieldtablet\n./extract-files.sh\n\n<span class=\"token comment\"># change directory to build root</span>\ncroot\n<span class=\"token comment\"># start multi-threaded make job for \"shieldtablet\" target</span>\nbrunch shieldtablet</code></pre></div>\n<p>Hint: <code class=\"language-text\">taskset -c 0-3 bash</code> to restrict a shell to only 4 cores (0-3; adjust as you need), then <code class=\"language-text\">envsetup</code> and <code class=\"language-text\">brunch</code>.</p>\n<h2 id=\"extracting-proprietary-files\" style=\"position:relative;\">Extracting proprietary files<a href=\"#extracting-proprietary-files\" aria-label=\"extracting proprietary files permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>Ooooo, this doesn't look good</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">44</span>/44<span class=\"token punctuation\">]</span> bootstrap /lineage/out/soong/.minibootstrap/build.ninja.in\n<span class=\"token punctuation\">[</span><span class=\"token number\">4</span>/4<span class=\"token punctuation\">]</span> /lineage/out/soong/.bootstrap/bin/minibp /lineage/out/soong/.bootstrap/build.ninja\n<span class=\"token punctuation\">[</span><span class=\"token number\">878</span>/879<span class=\"token punctuation\">]</span> glob vendor/qcom/opensource/interfaces/wifi/supplicant/1.0/Android.bp\n<span class=\"token punctuation\">[</span><span class=\"token number\">56</span>/56<span class=\"token punctuation\">]</span> /lineage/out/soong/.bootstrap/bin/soong_build /lineage/out/soong/build.ninja\n/lineage/out/build-lineage_shieldtablet.ninja is missing, regenerating<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">[</span><span class=\"token number\">742</span>/1072<span class=\"token punctuation\">]</span> including ./system/sepolicy/Android.mk <span class=\"token punctuation\">..</span>.\n./system/sepolicy/Android.mk:99: warning: BOARD_SEPOLICY_VERS not specified, assuming current platform version\n<span class=\"token punctuation\">[</span><span class=\"token number\">1072</span>/1072<span class=\"token punctuation\">]</span> including ./vendor/qcom/opensource/rcs-service/Android.mk <span class=\"token punctuation\">..</span>.\nPRODUCT_COPY_FILES device/nvidia/shield-common/keylayout/Vendor_054c_Product_0268.kl:system/usr/keylayout/Vendor_054c_Product_0268.kl ignored.\n<span class=\"token punctuation\">[</span> <span class=\"token number\">99</span>% <span class=\"token number\">1282</span>/1283<span class=\"token punctuation\">]</span> glob vendor/qcom/opensource/interfaces/wifi/supplicant/1.0/Android.bp\nninja: error: <span class=\"token string\">'vendor/nvidia/shieldtablet/proprietary/vendor/app/NvShieldTech/NvShieldTech.apk'</span>, needed by <span class=\"token string\">'/lineage/out/target/product/shieldtablet/obj/APPS/NvShieldTech_intermediates/package.apk'</span>, missing and no known rule to <span class=\"token function\">make</span> it\n<span class=\"token number\">22</span>:44:36 ninja failed with: <span class=\"token builtin class-name\">exit</span> status <span class=\"token number\">1</span>\n\n<span class=\"token comment\">#### failed to build some targets (27 seconds) ####</span></code></pre></div>\n<p>Which is caused most likely by errors from previous script (<code class=\"language-text\">extract-files.sh</code>)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">root@d886b12741a8:/lineage/device/nvidia/shieldtablet<span class=\"token comment\"># ./extract-files.sh</span>\nNo device is online. Waiting <span class=\"token keyword\">for</span> one<span class=\"token punctuation\">..</span>.\nPlease connect USB and/or <span class=\"token builtin class-name\">enable</span> USB debugging\nDevice Found.\nCleaning output directory <span class=\"token punctuation\">(</span>./<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/vendor/nvidia/shieldtablet/proprietary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span>\nExtracting <span class=\"token number\">160</span> files <span class=\"token keyword\">in</span> ./proprietary-files.txt from adb:\n  - /system/etc/hdcpsrm/hdcp1x.srm <span class=\"token punctuation\">..</span>\n  - /system/etc/hdcpsrm/hdcp2x.srm <span class=\"token punctuation\">..</span>\n  - /system/etc/hdcpsrm/hdcp2xtest.srm <span class=\"token punctuation\">..</span>\n  - /system/vendor/bin/downloader <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/glgps_nvidiaTegra2android <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/gps_select.sh <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/icera-switcherd <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/modemnic <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/rm_ts_server <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/run_ss_status.sh <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/ss_status <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/tlk_daemon <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span>\n  - /system/vendor/bin/ussrd <span class=\"token punctuation\">..</span>\n    <span class=\"token operator\">!</span><span class=\"token operator\">!</span> <span class=\"token function\">file</span> not found <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">source</span></code></pre></div>\n<p>Full output I saved in <a href=\"https://gist.github.com/mikolasan/8681c615a4e5e7d321c1fd453cb932ca\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">a gist</a></p>\n<p>I did some investigation.\nHere is <a href=\"https://gitlab.com/LineageOS/issues/android/-/issues/1476\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">an issue</a> with similar errors.\nSeems like I've missed one note on the wiki, saying that these files must be taken from a tablet where Lineage OS is already installed.</p>\n<blockquote>\n<p>This step requires to have a device <strong>already running the latest LineageOS</strong>, based on the branch you wish to build for. If you don’t have access to such device, refer to <a href=\"https://wiki.lineageos.org/extracting_blobs_from_zips.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Extracting proprietary blobs from installable zip</a>.</p>\n<p><em>LineageOS <a href=\"https://wiki.lineageos.org/devices/shieldtablet/build\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">build instructions</a></em></p>\n</blockquote>\n<p>So I can retrieve it from installed Lineage OS, or zip file, or <a href=\"https://github.com/TheMuppets/proprietary_vendor_nvidia/tree/lineage-15.1\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">proprietary_vendor_nvidia</a> repository (possible mirror or fork <a href=\"https://gitlab.incom.co/CM-Shield/proprietary_vendor_nvidia/-/blob/lineage-15.1/shield/shieldtablet.mk\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">on gitlab</a>).</p>\n<p>I can see that I downloaded the same files to <code class=\"language-text\">/lineage/vendor/nvidia/shieldtablet/proprietary/vendor/firmware/</code> as in <a href=\"https://github.com/TheMuppets/proprietary_vendor_nvidia/tree/lineage-15.1/shield/firmware/t124\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">shield/firmware/t124</a> but actually they have different hashes</p>\n<p>If you extract blobs from <a href=\"https://androidfilehost.com/?w=files&#x26;flid=325335\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">zip</a> (like <strong>lineage-15.1-20211018-UNOFFICIAL-shieldtablet.zip</strong>), then you need to read \"Extracting proprietary blobs from block-based OTAs\" <a href=\"https://wiki.lineageos.org/extracting_blobs_from_zips#extracting-proprietary-blobs-from-block-based-otas\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">link</a>. Check out <a href=\"https://cyanogenmodroms.com/shieldtablet/#Extract_proprietary_blobs\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">this howto</a> too. And again they will have different hashes</p>\n<p>Hierarchy is strange, so I manually moved missing files</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /system_dump/system/vendor/app/ConsoleUI\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-v</span> /proprietary_vendor_nvidia/shield/app/ConsoleUI/ConsoleUI.apk /system_dump/system/vendor/app/ConsoleUI\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-v</span> /shieldtablet/shieldtablet.real.bak/proprietary/vendor/lib/libaffinitydaemon.so /system_dump/system/vendor/lib\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-v</span> /shieldtablet/shieldtablet.real.bak/proprietary/vendor/lib/libgov* /system_dump/system/vendor/lib\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-v</span> /shieldtablet/shieldtablet.real.bak/proprietary/vendor/lib/libshieldtech.so /system_dump/system/vendor/lib\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-v</span> /shieldtablet/shieldtablet.real.bak/proprietary/vendor/lib/libussrd.so /system_dump/system/vendor/lib\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-v</span> /shieldtablet/shieldtablet.real.bak/proprietary/vendor/lib/nvshieldtech.so /system_dump/system/vendor/lib</code></pre></div>\n<p>What's missing from zip</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/system/vendor/bin/ussrd\n/system/vendor/firmware/tegra_xusb_firmware\n/system/vendor/lib/libaffinitydaemon.so\n/system/vendor/lib/libgov_boot.so\n/system/vendor/lib/libgov_camera.so\n/system/vendor/lib/libgov_force.so\n/system/vendor/lib/libgov_generic.so\n/system/vendor/lib/libgov_gpucompute.so\n/system/vendor/lib/libgov_graphics.so\n/system/vendor/lib/libgov_il.so\n/system/vendor/lib/libgov_spincircle.so\n/system/vendor/lib/libgov_tbc.so\n/system/vendor/lib/libgov_ui.so\n/system/vendor/lib/libshieldtech.so\n/system/vendor/lib/libussrd.so\n/system/vendor/lib/nvshieldtech.so\n/system/vendor/app/ConsoleUI/ConsoleUI.apk</code></pre></div>\n<p>What's missing from official ROM</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/system/vendor/bin/downloader\n/system/vendor/bin/glgps_nvidiaTegra2android\n/system/vendor/bin/gps_select.sh\n/system/vendor/bin/icera-switcherd\n/system/vendor/bin/modemnic\n/system/vendor/bin/rm_ts_server\n/system/vendor/bin/run_ss_status.sh\n/system/vendor/bin/ss_status\n/system/vendor/bin/tlk_daemon\n/system/vendor/bin/ussrd\n/system/vendor/firmware/bcm43241.hcd\n/system/vendor/firmware/nvram_43241.txt\n/system/vendor/firmware/tegra12x/nvhost_tsec.fw\n/system/vendor/firmware/tegra12x_xusb_firmware\n/system/vendor/firmware/tegra_xusb_firmware\n/system/vendor/lib/hw/gps.brcm.so\n/system/vendor/lib/hw/sensors.default.api_v1.3.mpl520.nvs.so\n/system/vendor/lib/libmllite.so\n/system/vendor/lib/libmplmpu.so\n/system/vendor/lib/libopencv24_tegra.so\n/system/vendor/lib/libprotobuf-cpp-lold.so\n/system/vendor/lib/libril-icera.so\n/system/vendor/lib/libsensors.fusion.mpl520.nvs.so\n/system/vendor/lib/libsensors.hal-drivers.nvs.so\n/system/vendor/lib/libsensors.hal.nvs.so\n/system/vendor/lib/libsensors.prefusion.mpl520.nvs.so\n/system/vendor/lib/libtbb.so\n/system/vendor/lib/libw.so\n/system/vendor/lib/touch_para_10.so\n/system/vendor/app/NvShieldTech/NvShieldTech.apk</code></pre></div>\n<p>Maybe it's hard to see but files in these lists almost do not overlap, therefore I will use zip and replenish missing files using my ROM.</p>\n<p>But here's what I must delete for sure from <code class=\"language-text\">device/nvidia/shieldtablet/proprietary-files.txt</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/system/vendor/bin/ussrd\n/system/vendor/firmware/tegra_xusb_firmware</code></pre></div>\n<p>And then I used the following command that doesn't use <code class=\"language-text\">adb</code> but just uses files from another folder</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./extract-files.sh /system_dump/</code></pre></div>\n<h2 id=\"troubleshooting-jack\" style=\"position:relative;\">Troubleshooting Jack<a href=\"#troubleshooting-jack\" aria-label=\"troubleshooting jack permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>It was not so easy with <a href=\"https://source.android.com/docs/setup/create/jack\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Jack</a>, because it's another piece of software that I've never heard of. Yes, those 80 gigabytes of kernel stuff didn't worry me so much as this one.</p>\n<p>I've got this error</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Launching Jack server java -XX:MaxJavaStackTraceDepth=-1 -Djava.io.tmpdir=/tmp -Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx4G -cp /root/.jack-server/launcher.jar com.android.jack.launcher.ServerLauncher\nJack server failed to (re)start, try 'jack-diagnose' or see Jack server log\nSSL error when connecting to the Jack server. Try 'jack-diagnose'</code></pre></div>\n<p>So here's a few helpful commands that help you to tame this beast</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">jack-admin kill-server\njack-admin start-server</code></pre></div>\n<p>The problem was fixed by <a href=\"https://stackoverflow.com/questions/67363030/rebuild-android-code-with-error-ssl-error-when-connecting-to-the-jack-server-t\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">enabling deprecated TLS algorithms</a> in Java 8. I added that to my initial Docker commands above.</p>\n<h2 id=\"next\" style=\"position:relative;\">Next<a href=\"#next\" aria-label=\"next permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>I build <a href=\"/linux/build-lineage-16\">Lineage 16 from source</a></p>","excerpt":"Here is the story of how I started upgrading Android on my Nvidia Shield tablet because one day I saw a popup in the app, where I read…","tableOfContents":"<ul>\n<li><a href=\"#setup-docker\">Setup Docker</a></li>\n<li><a href=\"#extracting-proprietary-files\">Extracting proprietary files</a></li>\n<li><a href=\"#troubleshooting-jack\">Troubleshooting Jack</a></li>\n<li><a href=\"#next\">Next</a></li>\n</ul>","fields":{"socialcard":"gatsby-plugin-social-card/90a161b4-c9da-5a0d-bdad-0d608fb7f9dd.jpg"},"frontmatter":{"date":"June 20, 2023","published":"June 20, 2023","lastModified":"June 24, 2023","title":"Build Lineage 15","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/build-lineage-15.md","url":"/linux/build-lineage-15","next":{"excerpt":"Here is the story of how I continued upgrading Android on my Nvidia Shield tablet because one day I saw a popup in the app, where I read…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/build-lineage-16.md","frontmatter":{"title":"Build Lineage 16","date":"2023-06-27T00:00:00.000Z","topic":null,"article":null},"id":"b4b3a0f7-e09c-5c6f-bcd0-74e7ec0ad8c0"},"previous":{"excerpt":"What to build I build Lineage 15.1 from source. With some complications, but apparently it is possible and this inspired me to go further…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/upgrade-android-on-nvidia-shield.md","frontmatter":{"title":"Upgrade Android on Nvidia Shield","date":"2023-06-17T00:00:00.000Z","topic":null,"article":null},"id":"f59a1451-4873-55e9-a27d-2238928dad3c"},"recentArticles":[{"excerpt":"The time is now. So you are following the official path","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/lunar-vim.md","frontmatter":{"title":"Lunar Vim","date":"2025-07-12T00:00:00.000Z","topic":null,"article":null},"id":"96fd1359-d24f-593f-bfd5-c6ea877b7e1e"},{"excerpt":"Prologue When I changed my email with Asana, the service that I liked so much, I found it when I had trouble planning my day, forgiving…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/task-management-with-taskwarrior.md","frontmatter":{"title":"Task management with taskwarrior","date":"2025-06-19T00:00:00.000Z","topic":null,"article":null},"id":"d251091d-7777-5f57-a398-6317d95233da"},{"excerpt":"I called my pool 'dinosaur' and three datasets, you guessed it, triassic, jurassic, cretaceous Steps: Reference archwiki - zfs zfs handbook…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/encrypted-backup-with-zfs.md","frontmatter":{"title":"Encrypted backup with ZFS","date":"2025-06-10T00:00:00.000Z","topic":null,"article":null},"id":"a8cfe7c2-1870-5a4d-a4b6-a9e5cb56f73b"},{"excerpt":"I already got used to auto-starting services when they run with docker compose or docker stack, but I like it even more when the apps run…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/autostart-everything.md","frontmatter":{"title":"Autostart everything","date":"2025-05-26T00:00:00.000Z","topic":null,"article":null},"id":"7c1cd1ea-fc7f-558a-9576-5f5420866bad"},{"excerpt":"So this happened when I was working on a Go project and quite frequently compiled binaries for deployment in docker containers. I didn't pay…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/linux/clear-space.md","frontmatter":{"title":"Clear space on Linux","date":"2025-04-15T00:00:00.000Z","topic":null,"article":null},"id":"b3347ef2-f534-5c29-bc5e-0ed82ca4c7ee"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}