{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/saga-of-com-ports","result":{"data":{"markdownRemark":{"html":"<h2 id=\"commands\" style=\"position:relative;\">Commands<a href=\"#commands\" aria-label=\"commands permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>View the activity</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> /proc/tty/driver/serial</code></pre></div>\n<p>Example output:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">serinfo:1.0 driver revision:\n0: uart:16550A port:00004310 irq:32 tx:70610 rx:70683 RTS|CTS|DTR|DSR|CD|RI\n1: uart:16550A port:00004318 irq:32 tx:6352 rx:12704 RTS|CTS|DTR|DSR|CD|RI\n2: uart:16550A port:00004320 irq:32 tx:16314 rx:0 RTS|DTR|DSR|CD|RI\n3: uart:16550A port:00004328 irq:32 tx:132 rx:0 DSR|CD|RI\n4: uart:16550A port:00004300 irq:32 tx:0 rx:0 DSR|CD|RI\n5: uart:16550A port:00004308 irq:32 tx:0 rx:0 DSR|CD|RI</code></pre></div>\n<p>Get current port settings</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">stty <span class=\"token parameter variable\">-F</span> /dev/ttyS0 <span class=\"token parameter variable\">-a</span></code></pre></div>\n<p>Example output</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">speed 9600 baud; rows 0; columns 0; line = 0;\nintr = ^C; quit = ^; erase = ^?; kill = ^U; eof = ^D; eol = &lt;undef>; eol2 = &lt;undef>; swtch = &lt;undef>;\nstart = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0;\n-parenb -parodd -cmspar cs8 hupcl -cstopb cread -clocal -crtscts\n-ignbrk -brkint ignpar -parmrk -inpck -istrip -inlcr -igncr -icrnl -ixon -ixoff -iuclc -ixany -imaxbel\n-iutf8\n-opost -olcuc -ocrnl -onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0\n-isig -icanon -iexten -echo -echoe -echok -echonl -noflsh -xcase -tostop -echoprt -echoctl -echoke -flusho\n-extproc</code></pre></div>\n<h2 id=\"ownership\" style=\"position:relative;\">Ownership<a href=\"#ownership\" aria-label=\"ownership permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>The <code class=\"language-text\">c_cflag</code> member contains two options that should always be enabled, <code class=\"language-text\">CLOCAL</code> and <code class=\"language-text\">CREAD</code>. These will ensure that your program does not become the 'owner' of the port subject to sporatic job control and hangup signals, and also that the serial interface driver will read incoming data bytes.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">-x</span>\n\n<span class=\"token function-name function\">setup_com_port</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\n    <span class=\"token comment\"># set baud rate, disable modem control signals</span>\n    stty <span class=\"token parameter variable\">-F</span> <span class=\"token string\">\"/dev/ttyS<span class=\"token variable\">$id</span>\"</span> <span class=\"token number\">9600</span> eof ^D min <span class=\"token number\">0</span> <span class=\"token function\">time</span> <span class=\"token number\">8</span> clocal <span class=\"token parameter variable\">-ignpar</span> inpck parenb\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    setup_com_port <span class=\"token variable\">$1</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">i</span> <span class=\"token keyword\">in</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">seq</span> <span class=\"token number\">0</span> <span class=\"token number\">5</span><span class=\"token variable\">)</span></span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span>\n        setup_com_port <span class=\"token variable\">$i</span>\n    <span class=\"token keyword\">done</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>Magical touch with the <strong>screen</strong> utility</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token comment\"># touch ports</span>\n<span class=\"token function\">screen</span> <span class=\"token parameter variable\">-S</span> com5 <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-m</span> /dev/ttyS4\n<span class=\"token function\">screen</span> <span class=\"token parameter variable\">-S</span> com7 <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-m</span> /dev/ttyS6\n<span class=\"token function\">screen</span> <span class=\"token parameter variable\">-S</span> com8 <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-m</span> /dev/ttyS7\n\n<span class=\"token comment\"># kill screen sessions</span>\n<span class=\"token function\">screen</span> <span class=\"token parameter variable\">-S</span> com5 <span class=\"token parameter variable\">-X</span> <span class=\"token function\">kill</span>\n<span class=\"token function\">screen</span> <span class=\"token parameter variable\">-S</span> com7 <span class=\"token parameter variable\">-X</span> <span class=\"token function\">kill</span>\n<span class=\"token function\">screen</span> <span class=\"token parameter variable\">-S</span> com8 <span class=\"token parameter variable\">-X</span> <span class=\"token function\">kill</span></code></pre></div>\n<p>Links:</p>\n<ul>\n<li><a href=\"https://www.cmrr.umn.edu/~strupp/serial.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\"></a></li>\n<li><a href=\"http://ezv24.sourceforge.net/api-html/ezV24_8h.html#ac5c162d1349468a5baf6b7ba0e10ada6\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\"></a></li>\n<li><a href=\"https://github.com/joede/libezV24\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\"></a></li>\n<li><a href=\"https://pythonhosted.org/pyserial/pyserial_api.html#classes\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\"></a></li>\n</ul>\n<h2 id=\"monitoring\" style=\"position:relative;\">Monitoring<a href=\"#monitoring\" aria-label=\"monitoring permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>I did a few silly commands to check the booting process and analyze when something is changed in the settings and how it affects the communication</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">while</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token function\">sudo</span> <span class=\"token function\">cat</span> /proc/tty/driver/serial <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> port:00004310 <span class=\"token operator\">|</span> ts <span class=\"token string\">'[%Y-%m-%d %H:%M:%S]'</span> <span class=\"token operator\">>></span> /var/log/serial.log<span class=\"token punctuation\">;</span> <span class=\"token function\">sleep</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span> <span class=\"token operator\">&amp;</span>\n<span class=\"token comment\"># example output:</span>\n<span class=\"token comment\"># [2024-10-17 10:21:12] 6: uart:16550A port:00004310 irq:32 tx:0 rx:0 RTS|CTS|DTR|DSR|CD|RI</span>\n\n<span class=\"token comment\"># sudo stty -F /dev/ttyS0 -a > working_serial_state</span>\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token function\">sudo</span> stty <span class=\"token parameter variable\">-F</span> /dev/ttyS0 <span class=\"token parameter variable\">-a</span> <span class=\"token operator\">|</span> <span class=\"token function\">diff</span> working_serial_state - <span class=\"token operator\">|</span> ts <span class=\"token string\">'[%Y-%m-%d %H:%M:%S]'</span> <span class=\"token operator\">>></span> /var/log/serial2.log<span class=\"token punctuation\">;</span> <span class=\"token function\">sleep</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span> <span class=\"token operator\">&amp;</span>\n<span class=\"token comment\"># example output:</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] 4,6c4,6</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] &lt; werase = ^W; lnext = ^V; discard = ^O; min = 0; time = 8;</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] &lt; parenb -parodd -cmspar cs8 -hupcl -cstopb cread clocal -crtscts</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] &lt; -ignbrk -brkint -ignpar -parmrk inpck -istrip -inlcr -igncr -icrnl -ixon -ixoff</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] ---</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] > werase = ^W; lnext = ^V; discard = ^O; min = 100; time = 2;</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] > -parenb -parodd -cmspar cs8 -hupcl -cstopb cread clocal -crtscts</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] > -ignbrk brkint ignpar -parmrk -inpck -istrip -inlcr -igncr -icrnl ixon -ixoff</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] 9c9</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] &lt; -isig -icanon -iexten -echo echoe echok -echonl -noflsh -xcase -tostop -echoprt</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] ---</span>\n<span class=\"token comment\"># [2024-10-17 10:21:11] > -isig -icanon iexten -echo echoe echok -echonl -noflsh -xcase -tostop -echoprt</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token function\">ls</span> <span class=\"token parameter variable\">-1</span> /dev/ttyS* <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -I<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token function\">sudo</span> <span class=\"token function\">lsof</span> <span class=\"token parameter variable\">-X</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> ts <span class=\"token string\">'[%Y-%m-%d %H:%M:%S]'</span> <span class=\"token operator\">>></span> /var/log/serial3.log<span class=\"token punctuation\">;</span> <span class=\"token function\">sleep</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span> <span class=\"token operator\">&amp;</span></code></pre></div>\n<h2 id=\"reference\" style=\"position:relative;\">Reference<a href=\"#reference\" aria-label=\"reference permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<ul>\n<li>Linux kernel <a href=\"https://tldp.org/HOWTO/Serial-HOWTO-15.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">boot parameters</a></li>\n<li><a href=\"https://serverfault.com/questions/137400/remapping-linux-serial-port-device-names\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Remapping with udev rules</a>: <code class=\"language-text\">ACTION==\"add\" KERNEL==\"ttyS2\" NAME=\"ttyS1\"</code></li>\n<li>Rename <code class=\"language-text\">mv /dev/ttyS2 /dev/ttyS1</code></li>\n<li>ModemManager can screw you over (<a href=\"https://modemmanager.org/docs/modemmanager/port-and-device-detection/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">documentation</a>)</li>\n<li><a href=\"https://sourceforge.net/projects/serlook/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Inspect serial port on Linux</a></li>\n<li><a href=\"https://serverfault.com/questions/112957/sniff-serial-port-on-linux\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Sniff serial port on Linux</a></li>\n<li><a href=\"https://stackoverflow.com/questions/940374/how-can-i-monitor-data-on-a-serial-port-in-linux\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Monitor serial port on Linux</a></li>\n</ul>","excerpt":"Commands View the activity Example output: Get current port settings Example output Ownership The  member contains two options that should…","tableOfContents":"<ul>\n<li><a href=\"#commands\">Commands</a></li>\n<li><a href=\"#ownership\">Ownership</a></li>\n<li><a href=\"#monitoring\">Monitoring</a></li>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>","fields":{"socialcard":"gatsby-plugin-social-card/be75b065-918f-5649-87fe-c8039a9971ca.jpg"},"frontmatter":{"date":"April 18, 2019","published":"August 08, 2024","lastModified":"August 08, 2024","title":"Saga of COM ports","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/saga-of-com-ports.md","url":"/blog/saga-of-com-ports","next":{"excerpt":"Making players to miss a turn is a serious punishment. Some people may find it very frustrating and will keep sour memories about the game…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/skip-next-turn-in-board-games.md","frontmatter":{"title":"Skip your next turn dilemma","date":"2020-02-29T00:00:00.000Z","topic":null,"article":null},"id":"7d971a3f-420d-55b9-8eb3-13aa48a525f2"},"previous":null,"recentArticles":[{"excerpt":"To read AI hype is over? (post from 2023) - L’IA n’est-elle qu’un mythe qui s’essoufflera ? About Google alternative services -  Comment j…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/learning-french.md","frontmatter":{"title":"How I am learning French","date":"2025-07-12T00:00:00.000Z","topic":null,"article":null},"id":"de46ffde-c202-594f-b222-f5f4a548fbe4"},{"excerpt":"I think I like having a dialogue with someone who knows about the topic, even with students who just obtained knowledge from canonical…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/lizards-and-continuous-space.md","frontmatter":{"title":"Lizards and Continuous space","date":"2025-06-23T00:00:00.000Z","topic":null,"article":null},"id":"6ee1f95a-2c05-5950-8a0d-20ff4d937fb1"},{"excerpt":"Yes, developers add new features, refactor other parts to get rid of technical debt. This often changes API, which usually triggers…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/new-ui-and-conspiracy-in-it-industry.md","frontmatter":{"title":"New UI","date":"2025-06-21T00:00:00.000Z","topic":null,"article":null},"id":"fe2e710c-0afa-5b11-8a7d-1dc46d02f0f9"},{"excerpt":"Now when I almost finished with the titanic competition (I didn’t reach 90% accuracy as I planned, although I doubt it’s possible), it’s…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/regulus.md","frontmatter":{"title":"Regulus","date":"2025-05-13T00:00:00.000Z","topic":null,"article":null},"id":"cf23a6fc-e0e2-571b-9dbf-5030b3af25dd"},{"excerpt":"When I found out there was a popular platform where people share open source projects, I imagined GitHub differently. I thought I could find…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/how-github-should-work.md","frontmatter":{"title":"How GitHub should work","date":"2025-04-03T00:00:00.000Z","topic":null,"article":null},"id":"63562cc8-f132-5cbc-a444-5639c4a78d98"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}