{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/fix-grub-rescue","result":{"data":{"markdownRemark":{"html":"<p>The following answer by <a href=\"https://unix.stackexchange.com/a/193778/78773\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Ivan Bartsov</a> is copied from <a href=\"https://unix.stackexchange.com/questions/114429/short-read-while-trying-to-open-partition/193778#193778\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Unix&#x26;Linux Stack Exchange</a></p>\n<hr>\n<p><em>Ext</em> filesystems store backups of the superblock -- for an occasion just like this one.</p>\n<p>First, determine the locations of the backups (<strong>make sure you have the -n option!</strong> otherwise this will wipe the file system with a new one):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mke2fs -n /dev/sdxx</code></pre></div>\n<p>This is a test run (i.e. no write) of FS creation routine. It will let you know the offsets of where it <em>would</em> put superblock backups if it were creating a filesystem. If you know your FS block size to be something other than 4096, you must also specify the parameter <code class=\"language-text\">-b {blocksize}</code> to get the right numbers.</p>\n<p>For 4096-sized blocks, first backup superblock will be at <code class=\"language-text\">32768</code>. If the following operations fail with the same error message about bad superblock/short read, try the next superblock backup from the list <code class=\"language-text\">mke2fs</code> gave you.</p>\n<p>Next, you can either mount the filesystem using the backup superblock like this</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mount -o sb=32768 /dev/sdxx /mnt/sdxx</code></pre></div>\n<p>then explore the FS from your file manager, copy undamaged files etc.</p>\n<p>Or, to actually fix the FS, you can run <code class=\"language-text\">fsck</code> with backup superblock like this</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">e2fsck -fy -b 32768 /dev/sdxx</code></pre></div>\n<p>Here <code class=\"language-text\">-f</code> makes it scan the disk even if it's not dirty and <code class=\"language-text\">-y</code> answers yes to all enquiries about fixing stuff. The <code class=\"language-text\">-b</code> option, aside from specifying the backup superblock, will make it update the original superblock with info from backup.</p>\n<p>After this, you should have your filesystem back.</p>\n<p><strong>If e2fsck fails to write the main superblock</strong>\nIf the superblock got corrupted because it's on a bad sector <code class=\"language-text\">e2fsck</code> will finish the run, attempt to update the superblock, and give you the following error message:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error writing block 1 (Attempt to write block from filesystem resulted in short write)</code></pre></div>\n<p>Obviously, the main superblock isn't updated and the whole <code class=\"language-text\">e2fsck</code> run is in vain.</p>\n<p>You need to hint the disk to remap that sector -- by writing zeroes to it. Thanks to @Keith for pointing this out: <strong>the next command can make a lot of mess if mistyped</strong>, so triple-check it before running. Here's the magic:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dd if=/dev/zero of=/dev/sdxx bs=4096 count=1 seek=0</code></pre></div>\n<p>This will write 1 4096-sized block of zeroes to <em>sdxx</em> at offset 0. Don't forget to account for different block size if that's the case for you.</p>\n<p>After that you'll be able to write to superblock (which will be on a different physical sector transparently to you). Now, you run the <code class=\"language-text\">e2fsck</code> command above again and it should succeed writing the superblock allowing you to mount the FS normally.</p>\n<p><strong>Goes without saying</strong> Now you should backup the critical data to another <em>physical</em> drive and, if you still plan on using the filesystem, run</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">e2fsck -fccy /dev/sdxx</code></pre></div>\n<p><em>PS</em> Kudos to @Nemo on this find: in case all of the backups of the superblock of your FS are corrupted, <code class=\"language-text\">mke2fs/mkfs</code> has the <em>-S</em> option that will re-create the superblock and group descriptors as if creating a new filesystem, without touching anything else. <strong>But</strong> you absolutely have to be sure your blocksize is right and the man page says you should run <code class=\"language-text\">e2fsck</code> after it and there are no guarantees about data being left for rescuing. <a href=\"http://manpages.ubuntu.com/manpages/trusty/en/man8/mkfs.ext4.8.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Read the man page</a> and throw a plus on <a href=\"https://askubuntu.com/questions/381518/recover-from-a-corrupted-filesystem-when-fsck-do-not-help/381759#381759\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">this answer</a>.</p>","excerpt":"The following answer by Ivan Bartsov is copied from Unix&Linux Stack Exchange Ext filesystems store backups of the superblock -- for an…","tableOfContents":"","fields":{"socialcard":"gatsby-plugin-social-card/0b67f31f-6ac5-59d0-ab30-4cf5069dcba7.jpg"},"frontmatter":{"date":"January 31, 2023","published":"February 07, 2023","lastModified":"May 14, 2023","title":"Fix Grub rescue","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/fix-grub-rescue.md","url":"/blog/fix-grub-rescue","next":{"excerpt":"Last Sunday on a hike I was thinking if robots can love. I somehow came to that topic after reviewing associative memory and an ability of…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/ai-analyzes-geopolitics.md","frontmatter":{"title":"AI analyzes geopolitics","date":"2023-02-20T00:00:00.000Z","topic":null,"article":null},"id":"eb1380eb-a3ff-56d4-bdf3-65ac7784aa34"},"previous":{"excerpt":"Sometimes using  on Linux you can get a long traceback message instead of a plot that you expected.\nStrangely it says something about key…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/matplotlib-on-linux.md","frontmatter":{"title":"Matplotlib on linux","date":"2023-01-27T00:00:00.000Z","topic":null,"article":null},"id":"44a02b53-1fa9-5d03-9329-71178d64ea4a"},"recentArticles":[{"excerpt":"To read AI hype is over? (post from 2023) - L’IA n’est-elle qu’un mythe qui s’essoufflera ? About Google alternative services -  Comment j…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/learning-french.md","frontmatter":{"title":"How I am learning French","date":"2025-07-12T00:00:00.000Z","topic":null,"article":null},"id":"de46ffde-c202-594f-b222-f5f4a548fbe4"},{"excerpt":"I think I like having a dialogue with someone who knows about the topic, even with students who just obtained knowledge from canonical…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/lizards-and-continuous-space.md","frontmatter":{"title":"Lizards and Continuous space","date":"2025-06-23T00:00:00.000Z","topic":null,"article":null},"id":"6ee1f95a-2c05-5950-8a0d-20ff4d937fb1"},{"excerpt":"Yes, developers add new features, refactor other parts to get rid of technical debt. This often changes API, which usually triggers…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/new-ui-and-conspiracy-in-it-industry.md","frontmatter":{"title":"New UI","date":"2025-06-21T00:00:00.000Z","topic":null,"article":null},"id":"fe2e710c-0afa-5b11-8a7d-1dc46d02f0f9"},{"excerpt":"Now when I almost finished with the titanic competition (I didn’t reach 90% accuracy as I planned, although I doubt it’s possible), it’s…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/regulus.md","frontmatter":{"title":"Regulus","date":"2025-05-13T00:00:00.000Z","topic":null,"article":null},"id":"cf23a6fc-e0e2-571b-9dbf-5030b3af25dd"},{"excerpt":"When I found out there was a popular platform where people share open source projects, I imagined GitHub differently. I thought I could find…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/blog/how-github-should-work.md","frontmatter":{"title":"How GitHub should work","date":"2025-04-03T00:00:00.000Z","topic":null,"article":null},"id":"63562cc8-f132-5cbc-a444-5639c4a78d98"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}