{"componentChunkName":"component---src-templates-blog-template-js","path":"/code/java/java-tcp-secure-server-socket","result":{"data":{"markdownRemark":{"html":"<p>Java TCP Server Socket with certificate and private key (TLS).</p>\n<p>Let's delve into the specifics of how to use Java's built-in security libraries to create a secure server socket, using the Secure Sockets Layer (SSL) and Transport Layer Security (TLS) protocols.</p>\n<p>To load a Java keystore from resources, we'll be using the <code class=\"language-text\">getResourceAsStream()</code> method. This method allows us to load a file from the classpath, which is the set of directories where Java looks for class files. By loading the keystore from resources, we can avoid hardcoding the keystore path in our code, making it more portable and secure.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span>ssl<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">KeyManagerFactory</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span>ssl<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SSLContext</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span>ssl<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SSLServerSocket</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span>ssl<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SSLServerSocketFactory</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocket</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">KeyStore</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyServer</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">SERVER_PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">8686</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ServerSocket</span> serverSocket<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MyServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">SSLServerSocket</span> socket <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SSLServerSocket</span><span class=\"token punctuation\">)</span><span class=\"token function\">initSSLServerSocketFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">createServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SERVER_PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            serverSocket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SSLServerSocketFactory</span> <span class=\"token function\">initSSLServerSocketFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">InputStream</span> inputStream <span class=\"token operator\">=</span> <span class=\"token class-name\">MyServer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server.jks\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">KeyStore</span> keyStore <span class=\"token operator\">=</span> <span class=\"token class-name\">KeyStore</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"JKS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            keyStore<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>inputStream<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;store password>\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">toCharArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">KeyManagerFactory</span> keyManagerFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">KeyManagerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SunX509\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            keyManagerFactory<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>keyStore<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;key password>\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">toCharArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">SSLContext</span> sslContext <span class=\"token operator\">=</span> <span class=\"token class-name\">SSLContext</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TLS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            sslContext<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>keyManagerFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getKeyManagers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> sslContext<span class=\"token punctuation\">.</span><span class=\"token function\">getServerSocketFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ...</span></code></pre></div>\n<p>See how to create the key store <a href=\"/linux/ssl-certificates\">here</a></p>\n<h2 id=\"reference\" style=\"position:relative;\">Reference<a href=\"#reference\" aria-label=\"reference permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<ul>\n<li><a href=\"https://docs.oracle.com/javase/10/security/sample-code-illustrating-secure-socket-connection-client-and-server.htm#JSSEC-GUID-3561ED02-174C-4E65-8BB1-5995E9B7282C\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://docs.oracle.com/javase/10/security/sample-code-illustrating-secure-socket-connection-client-and-server.htm#JSSEC-GUID-3561ED02-174C-4E65-8BB1-5995E9B7282C</a></li>\n<li><a href=\"https://stackoverflow.com/questions/906402/how-to-import-an-existing-x-509-certificate-and-private-key-in-java-keystore-to\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/906402/how-to-import-an-existing-x-509-certificate-and-private-key-in-java-keystore-to</a></li>\n<li><a href=\"https://stackoverflow.com/questions/67766268/ioexception-in-java-8-when-reading-pkcs12-keystore-created-with-keytool-from-ope\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/67766268/ioexception-in-java-8-when-reading-pkcs12-keystore-created-with-keytool-from-ope</a></li>\n<li><a href=\"https://stackoverflow.com/questions/11905682/keymanagerfactory-cannot-recover-key-yet-it-opens-in-keytool\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/11905682/keymanagerfactory-cannot-recover-key-yet-it-opens-in-keytool</a></li>\n</ul>","excerpt":"Java TCP Server Socket with certificate and private key (TLS). Let's delve into the specifics of how to use Java's built-in security…","tableOfContents":"<ul>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>","fields":{"socialcard":"gatsby-plugin-social-card/459515db-ec6c-5fb1-ad78-d64943c21d57.jpg"},"frontmatter":{"date":"January 01, 2022","published":"January 01, 2022","lastModified":"January 01, 2022","title":"Java TCP secure server socket","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/java-tcp-secure-server-socket.md","url":"/code/java/java-tcp-secure-server-socket","next":null,"previous":{"excerpt":"Gradle snippet: build.gradle Add to your code (where the Test class is your code): Test.java Log levels From the manual: trace error warn…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/add-simple-logger-to-java-app.md","frontmatter":{"title":"Add simple logger","date":"2021-11-23T00:00:00.000Z","topic":null,"article":null},"id":"f8bcc269-8a0c-55db-ab38-9feb92ce11b4"},"recentArticles":[{"excerpt":"Java TCP Server Socket with certificate and private key (TLS). Let's delve into the specifics of how to use Java's built-in security…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/java-tcp-secure-server-socket.md","frontmatter":{"title":"Java TCP secure server socket","date":"2022-01-01T00:00:00.000Z","topic":null,"article":null},"id":"459515db-ec6c-5fb1-ad78-d64943c21d57"},{"excerpt":"Gradle snippet: build.gradle Add to your code (where the Test class is your code): Test.java Log levels From the manual: trace error warn…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/add-simple-logger-to-java-app.md","frontmatter":{"title":"Add simple logger","date":"2021-11-23T00:00:00.000Z","topic":null,"article":null},"id":"f8bcc269-8a0c-55db-ab38-9feb92ce11b4"},{"excerpt":"PF4J OSGI Custom (+ jar loading)","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/plugin-system-in-java.md","frontmatter":{"title":"Plugin system in Java","date":"2021-11-23T00:00:00.000Z","topic":null,"article":null},"id":"8e57dac5-14de-5777-b20c-e0d429ac1368"},{"excerpt":"api_c_wrap.c MyLibraryJNI.java MyLibrary.java Reference https://stackoverflow.com/questions/9630134/jni-how-to-callback-from-c-or-c-to-java…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/callback-from-c-to-java-method.md","frontmatter":{"title":"Callback from C to Java method","date":"2021-06-13T00:00:00.000Z","topic":null,"article":null},"id":"44fcef1b-519d-5727-b79e-729d45558283"},{"excerpt":"Consider you have a HTTPS server with ssl certificate, and you do want to use the certificate on your client side.\nHow to write HTTPS client…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/https-client-in-java.md","frontmatter":{"title":"Add CA certificate to Java HTTPS client","date":"2021-04-20T00:00:00.000Z","topic":null,"article":null},"id":"e8c1885b-97e2-5454-b7bc-ce75b26077e4"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}