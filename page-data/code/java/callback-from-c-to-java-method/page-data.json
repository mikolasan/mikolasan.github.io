{"componentChunkName":"component---src-templates-blog-template-js","path":"/code/java/callback-from-c-to-java-method","result":{"data":{"markdownRemark":{"html":"<p><strong>api_c_wrap.c</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;jni.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"api.h\"</span></span>\n\n<span class=\"token keyword\">static</span> JNIEnv<span class=\"token operator\">*</span> genv <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span> jclass gclass <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span> jmethodID gcallbackid <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">msg_callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"c/c++ callback !!!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  jstring message <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>genv<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewStringUTF</span><span class=\"token punctuation\">(</span>genv<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>genv<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">CallStaticVoidMethod</span><span class=\"token punctuation\">(</span>genv<span class=\"token punctuation\">,</span> gclass<span class=\"token punctuation\">,</span> gcallbackid<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\nSWIGEXPORT <span class=\"token keyword\">void</span> JNICALL <span class=\"token function\">Java_JNI_1set_1api_1msg_1callback</span><span class=\"token punctuation\">(</span>JNIEnv <span class=\"token operator\">*</span>jenv<span class=\"token punctuation\">,</span> jclass jcls<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  genv <span class=\"token operator\">=</span> jenv<span class=\"token punctuation\">;</span>\n  gclass <span class=\"token operator\">=</span> jcls<span class=\"token punctuation\">;</span>\n  gcallbackid <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>jenv<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">GetStaticMethodID</span><span class=\"token punctuation\">(</span>jenv<span class=\"token punctuation\">,</span> jcls<span class=\"token punctuation\">,</span> <span class=\"token string\">\"callMsgCallback\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"(Ljava/lang/String;)V\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">api_msg_callback</span><span class=\"token punctuation\">(</span>msg_callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>MyLibraryJNI.java</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyLibraryJNI</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ApiMsgCallback</span> msgCallback <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">int</span> <span class=\"token function\">set_api_msg_callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setMsgCallback</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApiMsgCallback</span> callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    msgCallback <span class=\"token operator\">=</span> callback<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">callMsgCallback</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java callMsgCallback\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    msgCallback<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>MyLibrary.java</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyLibrary</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">set_api_msg_callback</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApiMsgCallback</span> callback<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">MyLibraryJNI</span><span class=\"token punctuation\">.</span><span class=\"token function\">setMsgCallback</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">MyLibraryJNI</span><span class=\"token punctuation\">.</span><span class=\"token function\">slon_application_set_api_msg_callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"reference\" style=\"position:relative;\">Reference<a href=\"#reference\" aria-label=\"reference permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/9630134/jni-how-to-callback-from-c-or-c-to-java\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/9630134/jni-how-to-callback-from-c-or-c-to-java</a></li>\n<li><a href=\"https://stackoverflow.com/questions/6746078/implement-callback-function-in-jni-using-interface\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/6746078/implement-callback-function-in-jni-using-interface</a></li>\n<li><a href=\"https://stackoverflow.com/questions/56230509/what-is-the-difference-between-jobject-jclass-in-c-ndk\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/56230509/what-is-the-difference-between-jobject-jclass-in-c-ndk</a></li>\n<li><a href=\"https://github.com/android/ndk-samples/blob/master/hello-jniCallback/app/src/main/cpp/hello-jnicallback.c\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://github.com/android/ndk-samples/blob/master/hello-jniCallback/app/src/main/cpp/hello-jnicallback.c</a></li>\n</ul>","excerpt":"api_c_wrap.c MyLibraryJNI.java MyLibrary.java Reference https://stackoverflow.com/questions/9630134/jni-how-to-callback-from-c-or-c-to-java…","tableOfContents":"<ul>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>","fields":{"socialcard":"gatsby-plugin-social-card/44fcef1b-519d-5727-b79e-729d45558283.jpg"},"frontmatter":{"date":"June 13, 2021","published":"June 13, 2021","lastModified":"June 13, 2021","title":"Callback from C to Java method","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/callback-from-c-to-java-method.md","url":"/code/java/callback-from-c-to-java-method","next":{"excerpt":"PF4J OSGI Custom (+ jar loading)","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/plugin-system-in-java.md","frontmatter":{"title":"Plugin system in Java","date":"2021-11-23T00:00:00.000Z","topic":null,"article":null},"id":"8e57dac5-14de-5777-b20c-e0d429ac1368"},"previous":{"excerpt":"Consider you have a HTTPS server with ssl certificate, and you do want to use the certificate on your client side.\nHow to write HTTPS client…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/https-client-in-java.md","frontmatter":{"title":"Add CA certificate to Java HTTPS client","date":"2021-04-20T00:00:00.000Z","topic":null,"article":null},"id":"e8c1885b-97e2-5454-b7bc-ce75b26077e4"},"recentArticles":[{"excerpt":"Java TCP Server Socket with certificate and private key (TLS). Let's delve into the specifics of how to use Java's built-in security…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/java-tcp-secure-server-socket.md","frontmatter":{"title":"Java TCP secure server socket","date":"2022-01-01T00:00:00.000Z","topic":null,"article":null},"id":"459515db-ec6c-5fb1-ad78-d64943c21d57"},{"excerpt":"Gradle snippet: build.gradle Add to your code (where the Test class is your code): Test.java Log levels From the manual: trace error warn…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/add-simple-logger-to-java-app.md","frontmatter":{"title":"Add simple logger","date":"2021-11-23T00:00:00.000Z","topic":null,"article":null},"id":"f8bcc269-8a0c-55db-ab38-9feb92ce11b4"},{"excerpt":"PF4J OSGI Custom (+ jar loading)","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/plugin-system-in-java.md","frontmatter":{"title":"Plugin system in Java","date":"2021-11-23T00:00:00.000Z","topic":null,"article":null},"id":"8e57dac5-14de-5777-b20c-e0d429ac1368"},{"excerpt":"api_c_wrap.c MyLibraryJNI.java MyLibrary.java Reference https://stackoverflow.com/questions/9630134/jni-how-to-callback-from-c-or-c-to-java…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/callback-from-c-to-java-method.md","frontmatter":{"title":"Callback from C to Java method","date":"2021-06-13T00:00:00.000Z","topic":null,"article":null},"id":"44fcef1b-519d-5727-b79e-729d45558283"},{"excerpt":"Consider you have a HTTPS server with ssl certificate, and you do want to use the certificate on your client side.\nHow to write HTTPS client…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/java/https-client-in-java.md","frontmatter":{"title":"Add CA certificate to Java HTTPS client","date":"2021-04-20T00:00:00.000Z","topic":null,"article":null},"id":"e8c1885b-97e2-5454-b7bc-ce75b26077e4"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}