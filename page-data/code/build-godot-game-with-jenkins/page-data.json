{"componentChunkName":"component---src-templates-blog-template-js","path":"/code/build-godot-game-with-jenkins","result":{"data":{"markdownRemark":{"html":"<p>I choose Pipeline project in Jenkins, this allows me to create one Groovy script instead of doing it in GUI that may not support all features (for example, git LFS). With the script there is a catch though, it differs in syntax depending on what block you are using <code class=\"language-text\">pipeline</code> or <code class=\"language-text\">node</code>. And speaking in terms that Jenkins developers use: <a href=\"https://www.jenkins.io/doc/book/pipeline/#declarative-pipeline-fundamentals\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Declarative pipeline</a> or <a href=\"https://www.jenkins.io/doc/book/pipeline/#scripted-pipeline-fundamentals\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Scripted pipeline</a>. I will go through both of them and show what advantages they have.</p>\n<p><strong>Update:</strong> the latest pipelines for HTML5 and Windows export templates, and for Godot 4 are in <a href=\"https://gist.github.com/mikolasan/eaaa2b55ddf75da024639c05c5fada32\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">this gist</a></p>\n<h2 id=\"prerequisites\" style=\"position:relative;\">Prerequisites<a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<h3 id=\"jenkins\" style=\"position:relative;\">Jenkins<a href=\"#jenkins\" aria-label=\"jenkins permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p>I installed Jenkins from official Manjaro repository</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo pacman -s jenkins</code></pre></div>\n<p>and updated the config <strong>/etc/conf.d/jenkins</strong> to use Java 11</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">JAVA=/usr/lib/jvm/java-11-openjdk/bin/java</code></pre></div>\n<h3 id=\"docker\" style=\"position:relative;\">Docker<a href=\"#docker\" aria-label=\"docker permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p>To use <code class=\"language-text\">docker push</code> and <code class=\"language-text\">docker pull</code> locally you need to spin a <a href=\"https://docs.docker.com/registry/deploying/#run-a-local-registry\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">local registry</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker run -d -p 5000:5000 --restart=always --name registry registry:2</code></pre></div>\n<p>And fix access rights</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo usermod -aG docker jenkins\nsudo systemctl restart jenkins</code></pre></div>\n<h3 id=\"build-godot\" style=\"position:relative;\">Build Godot<a href=\"#build-godot\" aria-label=\"build godot permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p>Here a build script used in the pipelines, its intend is to build very small engine for 2D games by disabling all 3D features. And also it requires the <code class=\"language-text\">strip</code> command to strip out debug symbols.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token builtin class-name\">set</span> +x\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">BUILD_NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"saturdayscode\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token variable\">$GD_BUILD_TYPE</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"[WARNING] GD_BUILD_TYPE not set\"</span>\n<span class=\"token keyword\">fi</span>\n<span class=\"token assign-left variable\">platform_target_tools</span><span class=\"token operator\">=</span><span class=\"token string\">\"platform=x11\"</span>\n<span class=\"token assign-left variable\">export_settings</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span>\n\n<span class=\"token assign-left variable\">modules</span><span class=\"token operator\">=</span><span class=\"token string\">\"module_csg_enabled=no \\\n    module_dds_enabled=no \\\n    module_enet_enabled=no \\\n    module_etc_enabled=no \\\n    module_gdnative_enabled=no \\\n    module_gridmap_enabled=no \\\n    module_hdr_enabled=no \\\n    module_mobile_vr_enabled=no \\\n    module_pvr_enabled=no \\\n    module_recast_enabled=no \\\n    module_squish_enabled=no \\\n    module_tga_enabled=no \\\n    module_thekla_unwrap_enabled=no \\\n    module_tinyexr_enabled=no \\\n    module_visual_script_enabled=no \\\n    module_websocket_enabled=no\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GD_BUILD_TYPE</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"editor\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">platform_target_tools</span><span class=\"token operator\">=</span><span class=\"token string\">\"platform=x11 target=debug tools=yes\"</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GD_BUILD_TYPE</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"windows-templates\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">platform_target_tools</span><span class=\"token operator\">=</span><span class=\"token string\">\"platform=windows target=release_debug tools=no\"</span>\n    <span class=\"token assign-left variable\">export_settings</span><span class=\"token operator\">=</span><span class=\"token string\">\"disable_3d=yes use_lto=yes\"</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GD_BUILD_TYPE</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"templates\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">platform_target_tools</span><span class=\"token operator\">=</span><span class=\"token string\">\"platform=x11 target=release_debug tools=no\"</span>\n    <span class=\"token assign-left variable\">export_settings</span><span class=\"token operator\">=</span><span class=\"token string\">\"use_lto=yes\"</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GD_BUILD_TYPE</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"server\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">platform_target_tools</span><span class=\"token operator\">=</span><span class=\"token string\">\"platform=server target=release_debug tools=yes\"</span>\n<span class=\"token keyword\">fi</span>\n\nscons <span class=\"token variable\">$platform_target_tools</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token assign-left variable\">arch</span><span class=\"token operator\">=</span>x64 <span class=\"token punctuation\">\\</span>\n    <span class=\"token assign-left variable\">bits</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token assign-left variable\">use_static_cpp</span><span class=\"token operator\">=</span>yes <span class=\"token punctuation\">\\</span>\n    <span class=\"token assign-left variable\">minizip</span><span class=\"token operator\">=</span>no <span class=\"token punctuation\">\\</span>\n    <span class=\"token variable\">$export_settings</span> <span class=\"token punctuation\">\\</span>\n    <span class=\"token variable\">$modules</span></code></pre></div>\n<p>I'm using packages recommended in <a href=\"https://docs.godotengine.org/en/latest/development/compiling/compiling_for_linuxbsd.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">the docs</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> ubuntu:18.04</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt-get update &amp;&amp; <span class=\"token operator\">\\</span>\n    apt-get install --assume-yes --quiet <span class=\"token operator\">\\</span>\n        build-essential <span class=\"token operator\">\\</span>\n        python3 <span class=\"token operator\">\\</span>\n        scons <span class=\"token operator\">\\</span>\n        pkg-config <span class=\"token operator\">\\</span>\n        libx11-dev <span class=\"token operator\">\\</span>\n        libxcursor-dev <span class=\"token operator\">\\</span>\n        libxinerama-dev <span class=\"token operator\">\\</span>\n        libgl1-mesa-dev <span class=\"token operator\">\\</span>\n        libglu-dev <span class=\"token operator\">\\</span>\n        libasound2-dev <span class=\"token operator\">\\</span>\n        libpulse-dev <span class=\"token operator\">\\</span>\n        libfreetype6-dev <span class=\"token operator\">\\</span>\n        libssl-dev <span class=\"token operator\">\\</span>\n        libudev-dev <span class=\"token operator\">\\</span>\n        libxi-dev <span class=\"token operator\">\\</span>\n        libxrandr-dev <span class=\"token operator\">\\</span>\n        mingw-w64</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> build.sh /</span></code></pre></div>\n<p>It worked on Ubuntu 18 for version 3.1 and 3.2, but somewhere later they have updated Python to version 3. So we need to install it and update how the <code class=\"language-text\">python</code> command works</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Add 3 to the available alternatives</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> update-alternatives --install /usr/bin/python python /usr/bin/python3 1</span>\n<span class=\"token comment\"># Set python3 as the default python</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> update-alternatives --set python /usr/bin/python3</span>\n</code></pre></div>\n<p>This image must be in our local registry. So before running a build job on Jenkins, run the following command in an empty folder. This folder must include only <strong>Dockerfile</strong> and <strong>build.sh</strong>, otherwise it will copy other files into the image just making that image taking extra space for no reason.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo docker build --tag mylittledocker/godot --file Dockerfile .</code></pre></div>\n<h2 id=\"using-a-node-block\" style=\"position:relative;\">Using a Node block<a href=\"#using-a-node-block\" aria-label=\"using a node block permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>Let's start with a <strong>Scripted pipeline</strong>, because it's more elegant and compact, but not flexible at all.</p>\n<p>For start, this is how I build Godot engine in Jenkins</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">node <span class=\"token punctuation\">{</span>\n    stage <span class=\"token string\">'Checkout'</span>\n    git <span class=\"token string\">'https://github.com/godotengine/godot.git'</span>\n    \n    stage <span class=\"token string\">'Build'</span>\n    docker<span class=\"token punctuation\">.</span><span class=\"token function\">image</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mylittledocker/godot'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>inside <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">ansiColor</span><span class=\"token punctuation\">(</span><span class=\"token string\">'xterm'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            sh <span class=\"token string\">'cp /build.sh .'</span>\n            sh <span class=\"token string\">'chmod +x build.sh'</span>\n            sh <span class=\"token string\">'rm -rf bin/'</span>\n            <span class=\"token keyword\">def</span> build <span class=\"token operator\">=</span> <span class=\"token interpolation-string\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">env<span class=\"token punctuation\">.</span>GD_BUILD_TYPE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>build <span class=\"token operator\">==</span> <span class=\"token string\">'ALL'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                sh <span class=\"token string\">'GD_BUILD_TYPE=editor ./build.sh'</span>\n                sh <span class=\"token string\">'GD_BUILD_TYPE=templates ./build.sh'</span>\n                sh <span class=\"token string\">'GD_BUILD_TYPE=server ./build.sh'</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                sh <span class=\"token string\">'./build.sh'</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    stage <span class=\"token string\">'Archive'</span>\n    archiveArtifacts artifacts<span class=\"token punctuation\">:</span> <span class=\"token string\">'bin/godot*'</span><span class=\"token punctuation\">,</span> fingerprint<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> onlyIfSuccessful<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"lfs-example\" style=\"position:relative;\">LFS example<a href=\"#lfs-example\" aria-label=\"lfs example permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\"><span class=\"token keyword\">def</span> packageName <span class=\"token operator\">=</span> <span class=\"token string\">'game.tar.gz'</span>\n\nnode <span class=\"token punctuation\">{</span>\n    stage <span class=\"token string\">'Checkout'</span>\n    <span class=\"token function\">checkout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">$</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'GitSCM'</span><span class=\"token punctuation\">,</span>\n        branches<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">:</span> <span class=\"token string\">'*/stable'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        extensions<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">$</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'GitLFSPull'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        userRemoteConfigs<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>\n            credentialsId<span class=\"token punctuation\">:</span> <span class=\"token string\">'***'</span><span class=\"token punctuation\">,</span>\n            url<span class=\"token punctuation\">:</span> <span class=\"token string\">'git@bitbucket.org:***'</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    stage <span class=\"token string\">'Build'</span>\n    docker<span class=\"token punctuation\">.</span><span class=\"token function\">image</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mylittledocker/game'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>inside <span class=\"token punctuation\">{</span>\n        sh <span class=\"token string\">'make all'</span>\n    <span class=\"token punctuation\">}</span>\n    stage <span class=\"token string\">'Archive'</span>\n    archiveArtifacts artifacts<span class=\"token punctuation\">:</span> <span class=\"token string\">'game.tar.gz'</span><span class=\"token punctuation\">,</span> fingerprint<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> onlyIfSuccessful<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"using-a-pipeline-block\" style=\"position:relative;\">Using a Pipeline block<a href=\"#using-a-pipeline-block\" aria-label=\"using a pipeline block permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>What features we have here:</p>\n<ul>\n<li>multiline string in Groovy</li>\n<li>creating image and container right from the build script</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\"><span class=\"token keyword\">def</span> archiveName <span class=\"token operator\">=</span> <span class=\"token string\">'game.tar.gz'</span>\n<span class=\"token keyword\">def</span> dockerFile <span class=\"token operator\">=</span> <span class=\"token string\">'''FROM ubuntu:18.04\n\nRUN apt-get update &amp;&amp; apt-get install -y python3\nCOPY godot_server.x11.opt.tools.x64 /usr/bin\nRUN ln -sr /usr/bin/godot_server.x11.opt.tools.x64 /usr/bin/godot\n\nENV UID 1000\nENV GD_VERSION 3.1.2.devel\nRUN groupadd --system --gid $UID saturdayscode \\\n    &amp;&amp; useradd --create-home \\\n        --shell /bin/bash \\\n        --no-log-init \\\n        --system \\\n        --gid saturdayscode \\\n        --uid $UID saturdayscode\n\nUSER saturdayscode\nRUN mkdir -p \\\n    $HOME/.cache \\\n    $HOME/.local/share/godot/templates/$GD_VERSION \\\n    $HOME/.config\nCOPY linux_x11_64_debug /home/saturdayscode/.local/share/godot/templates/$GD_VERSION/'''</span>\n\n<span class=\"token keyword\">def</span> frontendImage\n\npipeline <span class=\"token punctuation\">{</span>\n    agent <span class=\"token punctuation\">{</span> label <span class=\"token string\">'godot'</span> <span class=\"token punctuation\">}</span>\n    environment <span class=\"token punctuation\">{</span>\n        PYTHONUNBUFFERED <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span>\n    stages <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">stage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Checkout'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            steps <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">dir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lobby'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">checkout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">$</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'GitSCM'</span><span class=\"token punctuation\">,</span> \n                        branches<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">:</span> <span class=\"token string\">'*/stable'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        extensions<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n                            <span class=\"token punctuation\">[</span><span class=\"token punctuation\">$</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'GitLFSPull'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">[</span><span class=\"token punctuation\">$</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'CheckoutOption'</span><span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">[</span><span class=\"token punctuation\">$</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'CloneOption'</span><span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">:</span> <span class=\"token number\">120</span><span class=\"token punctuation\">]</span>\n                        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        doGenerateSubmoduleConfigurations<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> \n                        extensions<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>\n                            <span class=\"token punctuation\">$</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'SubmoduleOption'</span><span class=\"token punctuation\">,</span> \n                            disableSubmodules<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> \n                            parentCredentials<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> \n                            recursiveSubmodules<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> \n                            trackingSubmodules<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n                        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> \n                        submoduleCfg<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> \n                        userRemoteConfigs<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>\n                            credentialsId<span class=\"token punctuation\">:</span> <span class=\"token string\">'***'</span><span class=\"token punctuation\">,</span>\n                            url<span class=\"token punctuation\">:</span> <span class=\"token string\">'git@bitbucket.org:***'</span>\n                        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">stage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Prepare container'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            steps <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">dir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'docker'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    copyArtifacts filter<span class=\"token punctuation\">:</span> <span class=\"token string\">'bin/godot.x11.debug.x64'</span><span class=\"token punctuation\">,</span>\n                        fingerprintArtifacts<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                        projectName<span class=\"token punctuation\">:</span> <span class=\"token string\">'godot-templates'</span><span class=\"token punctuation\">,</span>\n                        selector<span class=\"token punctuation\">:</span> <span class=\"token function\">lastSuccessful</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    sh <span class=\"token string\">'cp -v bin/godot.x11.debug.x64 linux_x11_64_debug'</span>\n                    copyArtifacts filter<span class=\"token punctuation\">:</span> <span class=\"token string\">'bin/godot_server.x11.opt.tools.x64'</span><span class=\"token punctuation\">,</span>\n                        fingerprintArtifacts<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                        projectName<span class=\"token punctuation\">:</span> <span class=\"token string\">'godot-server'</span><span class=\"token punctuation\">,</span>\n                        selector<span class=\"token punctuation\">:</span> <span class=\"token function\">lastSuccessful</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    sh <span class=\"token string\">'cp -v bin/godot_server.x11.opt.tools.x64 .'</span>\n                    script <span class=\"token punctuation\">{</span>\n                        writeFile file<span class=\"token punctuation\">:</span> <span class=\"token string\">'Dockerfile'</span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> dockerFile\n                        frontendImage <span class=\"token operator\">=</span> docker<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mylittledocker/game'</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">stage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Clean'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            when <span class=\"token punctuation\">{</span>\n                expression <span class=\"token punctuation\">{</span> <span class=\"token interpolation-string\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">env</span></span><span class=\"token string\">.CLEAN_IMPORT\"</span></span> <span class=\"token operator\">==</span> <span class=\"token string\">'true'</span> <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            steps <span class=\"token punctuation\">{</span>\n                sh <span class=\"token string\">'find -name \"*.import\" | xargs -i rm -rf \"{}\"'</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">stage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Build'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            steps <span class=\"token punctuation\">{</span>\n                script <span class=\"token punctuation\">{</span>\n                    frontendImage<span class=\"token punctuation\">.</span>inside <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">ansiColor</span><span class=\"token punctuation\">(</span><span class=\"token string\">'xterm'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                            sh <span class=\"token interpolation-string\"><span class=\"token string\">\"./build.py </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">env<span class=\"token punctuation\">.</span>GAME_BUILD</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span> \n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">stage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Archive'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            steps <span class=\"token punctuation\">{</span>\n                sh <span class=\"token interpolation-string\"><span class=\"token string\">\"cd Build &amp;&amp; tar -czf ../</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">archiveName</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> *\"</span></span>\n                archiveArtifacts artifacts<span class=\"token punctuation\">:</span> <span class=\"token interpolation-string\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">archiveName</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">,</span>\n                    fingerprint<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    onlyIfSuccessful<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"reference\" style=\"position:relative;\">Reference<a href=\"#reference\" aria-label=\"reference permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>Also you might be interested in reading these useful resources</p>\n<ul>\n<li><a href=\"https://hub.docker.com/r/barichello/godot-ci\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://hub.docker.com/r/barichello/godot-ci</a></li>\n<li>Jenkins Docker Workflow plugin - A look at inside() <a href=\"https://echorand.me/posts/jenkins-docker-workflow-inside/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://echorand.me/posts/jenkins-docker-workflow-inside/</a></li>\n<li>Docker Workflow plugin sources <a href=\"https://github.com/jenkinsci/docker-workflow-plugin/blob/74a2370901f41e8b5b541d768b440e2ab1cd1b18/src/main/java/org/jenkinsci/plugins/docker/workflow/client/DockerClient.java#L109\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://github.com/jenkinsci/docker-workflow-plugin/blob/74a2370901f41e8b5b541d768b440e2ab1cd1b18/src/main/java/org/jenkinsci/plugins/docker/workflow/client/DockerClient.java#L109</a></li>\n</ul>","excerpt":"I choose Pipeline project in Jenkins, this allows me to create one Groovy script instead of doing it in GUI that may not support all…","tableOfContents":"<ul>\n<li>\n<p><a href=\"#prerequisites\">Prerequisites</a></p>\n<ul>\n<li><a href=\"#jenkins\">Jenkins</a></li>\n<li><a href=\"#docker\">Docker</a></li>\n<li><a href=\"#build-godot\">Build Godot</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#using-a-node-block\">Using a Node block</a></p>\n<ul>\n<li><a href=\"#lfs-example\">LFS example</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#using-a-pipeline-block\">Using a Pipeline block</a></p>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>","fields":{"socialcard":"gatsby-plugin-social-card/aee9da37-bdbd-5b6a-a69e-749a27944780.jpg"},"frontmatter":{"date":"February 01, 2022","published":"February 22, 2022","lastModified":"May 22, 2022","title":"Build Godot game with Jenkins","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/build-godot-game-with-jenkins.md","url":"/code/build-godot-game-with-jenkins","next":{"excerpt":"Do you want to see a terminal on Windows like this  And write commits in customized vim  Then here is what you should do. Terminal Install…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/customize-git-bash-for-windows.md","frontmatter":{"title":"Customize Git Bash for Windows","date":"2022-02-11T00:00:00.000Z","topic":null,"article":null},"id":"f9032ac9-ac16-5d0f-acea-0795065296ee"},"previous":{"excerpt":"Check this page on how to get a thumbprint for a certificate References https://docs.microsoft.com/en-us/dotnet/api/system.net.http…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/https-client-in-c-sharp.md","frontmatter":{"title":"HTTPS client in C#","date":"2022-01-12T00:00:00.000Z","topic":null,"article":null},"id":"bb82af88-0a71-5420-8d2d-50c16a341086"},"recentArticles":[{"excerpt":"Then here is the list of alternatives Intel-IPP Links: https://software.intel.com/en-us/intel-ipp , https://github.com/intel/ipp-crypto…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/if-you-hate-openssl.md","frontmatter":{"title":"If you hate OpenSSL","date":"2024-05-10T00:00:00.000Z","topic":null,"article":null},"id":"0c36d8cc-31d2-582b-9929-51cf8bed8920"},{"excerpt":"cool thing for the background (play it together with egzod - royalty) nice globe  Cool WebGL examples (no code, sad)","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/webgl.md","frontmatter":{"title":"WebGL","date":"2023-07-17T00:00:00.000Z","topic":null,"article":null},"id":"1bbe4c4e-2cc1-5fec-a2ca-b8cefdbfc6ee"},{"excerpt":"Check that you have ESLint extension installed. (Optional) While you are playing with linters and VS Code extensions, you can think about a…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/eslint-for-gatsby-howto.md","frontmatter":{"title":"ESLint in VS Code for Gatsby 5 blog","date":"2023-05-29T00:00:00.000Z","topic":null,"article":null},"id":"5953c80a-01e6-56c1-985e-bb9c0b1f340b"},{"excerpt":"The reason behind \"connect, disconnect and then connect again\" behavior might be that the old socket was still listening because it was half…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/how-to-close-tcp-socket-in-nodejs.md","frontmatter":{"title":"How to close TCP socket in Node.js","date":"2023-02-02T00:00:00.000Z","topic":null,"article":null},"id":"e7b7740f-e7b4-565f-a843-05bf8c27fda3"},{"excerpt":"When does verification happen? From this wiki it seems like the get function does it. What security level to use? https://www.openssl.org…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/ssl-tls-client-socket-with-openssl.md","frontmatter":{"title":"SSL/TLS client socket with OpenSSL","date":"2023-01-26T00:00:00.000Z","topic":null,"article":null},"id":"1f2b456a-3ea6-5863-a966-8579f11b39bd"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}