{"componentChunkName":"component---src-templates-blog-template-js","path":"/code/finding-bias-in-prng","result":{"data":{"markdownRemark":{"html":"<h2 id=\"biased-scaling\" style=\"position:relative;\">Biased scaling<a href=\"#biased-scaling\" aria-label=\"biased scaling permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>First things first. How to find a bias in random number generator? But not that bias that all statistical tests search for in a stream of 32 bit numbers, but the bias after scaling.</p>\n<p><a href=\"https://www.pcg-random.org/posts/bounded-rands.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">This article</a>, <strong>Bounded rands</strong> is the answer. It also will explain how to avoid biased scaling.</p>\n<p>It's based on <a href=\"https://arxiv.org/pdf/1805.10941.pdf\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">this paper</a>, <strong>Fast Random Integer Generation in an Interval</strong> by Daniel Lemire which also has great insights.</p>\n<p>Let's check the Isaac RNG implemented in Javascript (<a href=\"https://github.com/rubycon/isaac.js\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">original repo</a>, <a href=\"https://github.com/StefanoBalocco/isaac.js\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">npm package repo</a>). The JavaScript implementation and the original C implementation from the <a href=\"http://burtleburtle.net/bob/rand/isaacafa.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">official website</a> looks similar. Also it produces the same sequence when they start from the same seed.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">2.3283064365386963e-10</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2^-32</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here <code class=\"language-text\">this.rand()</code> returns a random integer value in range [0, 2^32), then we divide it to convert it into a double (See paragraph <strong>FP multiply</strong> in the article).\n<code class=\"language-text\">0.5</code> is a fix for uint representation in JavaScript.</p>\n<p>And this method probably in every browser and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">MDN</a> warns you:</p>\n<blockquote>\n<p>If extremely large bounds are chosen (2^53 or higher), it's possible in extremely rare cases to reach the usually-excluded upper bound.</p>\n</blockquote>\n<p>And let's assume that you are going to generate a random value in a range by this code</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// return random value from [a, b) range</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">random</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>isaac<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>b <span class=\"token operator\">-</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Surprisingly, this is <a href=\"https://stackoverflow.com/questions/1527803/generating-random-whole-numbers-in-javascript-in-a-specific-range\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">very common</a> way to do it in the JavaScript world.</p>\n<p>So here is the way to properly use the <code class=\"language-text\">isaac</code> library implementing the OpenBSD algorithm</p>\n<p>:::note\nThe code for OpenBSD's <code class=\"language-text\">arc4random_uniform</code> (which is also used on OS X and iOS) adopts this strategy.\n:::</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> max_uint <span class=\"token operator\">=</span> <span class=\"token number\">0x100000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">rand_uint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> isaac<span class=\"token punctuation\">.</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> r <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> r <span class=\"token operator\">+</span> <span class=\"token number\">0x100000000</span> <span class=\"token operator\">:</span> r<span class=\"token punctuation\">;</span> <span class=\"token comment\">// fix uint representation in JavaScript</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">rand_in_range</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">range</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">rand_uint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> working_range <span class=\"token operator\">=</span> max_uint <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>max_uint <span class=\"token operator\">%</span> range<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">>=</span> working_range<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">=</span> <span class=\"token function\">rand_uint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result <span class=\"token operator\">%</span> range<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">random</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> <span class=\"token function\">rand_in_range</span><span class=\"token punctuation\">(</span>b <span class=\"token operator\">-</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"reference\" style=\"position:relative;\">Reference<a href=\"#reference\" aria-label=\"reference permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<ul>\n<li>More comments about the article <a href=\"https://stackoverflow.com/questions/61107920/how-does-bias-manifest-in-bounded-random-number-generation\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/61107920/how-does-bias-manifest-in-bounded-random-number-generation</a></li>\n<li>Some theory Random Number Generation by Chris Lomont <a href=\"http://lomont.org/papers/2008/Lomont_PRNG_2008.pdf\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">http://lomont.org/papers/2008/Lomont_PRNG_2008.pdf</a></li>\n<li>From Daniel Lemire's website <a href=\"https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/</a></li>\n<li>Maybe a good read: Design Flaws in the Implementation of the Ziggurat and Monty Python methods (and some remarks on Matlab randn) <a href=\"https://arxiv.org/pdf/math/0603058.pdf\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://arxiv.org/pdf/math/0603058.pdf</a></li>\n<li>The Debian PGP disaster that almost was <a href=\"https://rdist.root.org/2009/05/17/the-debian-pgp-disaster-that-almost-was/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://rdist.root.org/2009/05/17/the-debian-pgp-disaster-that-almost-was/</a></li>\n<li>A Primer On Randomness <a href=\"https://espadrine.github.io/blog/posts/a-primer-on-randomness.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://espadrine.github.io/blog/posts/a-primer-on-randomness.html</a></li>\n</ul>\n<h2 id=\"plot-the-error\" style=\"position:relative;\">Plot the error<a href=\"#plot-the-error\" aria-label=\"plot the error permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p><a href=\"https://nakedsecurity.sophos.com/2013/07/09/anatomy-of-a-pseudorandom-number-generator-visualising-cryptocats-buggy-prng/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Anatomy of a pseudorandom number generator</a> – visualising Cryptocat’s buggy PRNG</p>\n<div class=\"gatsby-highlight\" data-language=\"gnuplot\"><pre class=\"language-gnuplot\"><code class=\"language-gnuplot\">plot &quot;chi-square.300.fixed.txt&quot; w linesp, &quot;chi-square.300.txt&quot; w linesp</code></pre></div>\n<ul>\n<li><a href=\"https://nakedsecurity.sophos.com/2013/07/09/anatomy-of-a-pseudorandom-number-generator-visualising-cryptocats-buggy-prng/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://nakedsecurity.sophos.com/2013/07/09/anatomy-of-a-pseudorandom-number-generator-visualising-cryptocats-buggy-prng/</a></li>\n<li><a href=\"https://bic-berkeley.github.io/psych-214-fall-2016/arrays_and_images.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://bic-berkeley.github.io/psych-214-fall-2016/arrays_and_images.html</a></li>\n</ul>\n<h2 id=\"test-suites\" style=\"position:relative;\">Test suites<a href=\"#test-suites\" aria-label=\"test suites permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<h3 id=\"testu01--bigcrush\" style=\"position:relative;\">TestU01 / BigCrush<a href=\"#testu01--bigcrush\" aria-label=\"testu01  bigcrush permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<ul>\n<li><a href=\"http://simul.iro.umontreal.ca/testu01/tu01.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">http://simul.iro.umontreal.ca/testu01/tu01.html</a></li>\n<li>Test javascript in testU01 (by compiling the test suite with Emscripten) <a href=\"https://jtobin.io/crushing-isaac\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://jtobin.io/crushing-isaac</a></li>\n<li>testing popular random-number generators <a href=\"https://github.com/lemire/testingRNG\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://github.com/lemire/testingRNG</a></li>\n</ul>\n<h3 id=\"dieharder\" style=\"position:relative;\">Dieharder<a href=\"#dieharder\" aria-label=\"dieharder permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p><strong>isaac_test.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">isaac<span class=\"token punctuation\">.</span><span class=\"token function\">seed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> isaac<span class=\"token punctuation\">.</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> v <span class=\"token operator\">=</span> r <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> r <span class=\"token operator\">+</span> <span class=\"token number\">0x100000000</span> <span class=\"token operator\">:</span> r<span class=\"token punctuation\">;</span> <span class=\"token comment\">// fix uint representation in JavaScript</span>\n  process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>v <span class=\"token operator\">+</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>numbers-to-stream.cpp</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdint></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;limits></span></span>\n\n<span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">auto</span> max_size <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">numeric_limits</span><span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>streamsize<span class=\"token operator\">></span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token keyword\">const</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">uint32_t</span> input_number <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        std<span class=\"token double-colon punctuation\">::</span>cin <span class=\"token operator\">>></span> input_number<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>cin<span class=\"token punctuation\">.</span><span class=\"token function\">eof</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> std<span class=\"token double-colon punctuation\">::</span>cin<span class=\"token punctuation\">.</span><span class=\"token function\">bad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>cin<span class=\"token punctuation\">.</span><span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            std<span class=\"token double-colon punctuation\">::</span>cin<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// unset failbit</span>\n            std<span class=\"token double-colon punctuation\">::</span>cin<span class=\"token punctuation\">.</span><span class=\"token function\">ignore</span><span class=\"token punctuation\">(</span>max_size<span class=\"token punctuation\">,</span> <span class=\"token char\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// skip bad input</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">char</span> c <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>input_number <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF000000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">24</span><span class=\"token punctuation\">;</span>\n            std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> c<span class=\"token punctuation\">;</span>\n            c <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>input_number <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x00FF0000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\n            std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> c<span class=\"token punctuation\">;</span>\n            c <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>input_number <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x0000FF00</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\n            std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> c<span class=\"token punctuation\">;</span>\n            c <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>input_number <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x000000FF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> c<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">node</span> isaac_test.js <span class=\"token operator\">|</span> ./numbers-to-stream <span class=\"token operator\">|</span> dieharder <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-g</span> <span class=\"token number\">200</span></code></pre></div>\n<p>Here's the result with ISAAC seed = 0. One test is marked as <strong>WEAK</strong> for this seed, but it passes on another seed.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#=============================================================================#\n#            dieharder version 3.31.2 Copyright 2003 Robert G. Brown          #\n#=============================================================================#\n   rng_name    |rands/second|   Seed   |\nstdin_input_raw|  6.37e+05  |2933234618|\n#=============================================================================#\n        test_name   |ntup| tsamples |psamples|  p-value |Assessment\n#=============================================================================#\n   diehard_birthdays|   0|       100|     100|0.08296096|  PASSED\n      diehard_operm5|   0|   1000000|     100|0.90920381|  PASSED\n  diehard_rank_32x32|   0|     40000|     100|0.15277816|  PASSED\n    diehard_rank_6x8|   0|    100000|     100|0.98528270|  PASSED\n   diehard_bitstream|   0|   2097152|     100|0.06634944|  PASSED\n        diehard_opso|   0|   2097152|     100|0.22866042|  PASSED\n        diehard_oqso|   0|   2097152|     100|0.04849016|  PASSED\n         diehard_dna|   0|   2097152|     100|0.64789513|  PASSED\ndiehard_count_1s_str|   0|    256000|     100|0.95809155|  PASSED\ndiehard_count_1s_byt|   0|    256000|     100|0.43858498|  PASSED\n diehard_parking_lot|   0|     12000|     100|0.51526020|  PASSED\n    diehard_2dsphere|   2|      8000|     100|0.58505752|  PASSED\n    diehard_3dsphere|   3|      4000|     100|0.94691424|  PASSED\n     diehard_squeeze|   0|    100000|     100|0.66015259|  PASSED\n        diehard_sums|   0|       100|     100|0.34256512|  PASSED\n        diehard_runs|   0|    100000|     100|0.81029323|  PASSED\n        diehard_runs|   0|    100000|     100|0.78271848|  PASSED\n       diehard_craps|   0|    200000|     100|0.79607382|  PASSED\n       diehard_craps|   0|    200000|     100|0.76686571|  PASSED\n marsaglia_tsang_gcd|   0|  10000000|     100|0.76298025|  PASSED\n marsaglia_tsang_gcd|   0|  10000000|     100|0.99609551|   WEAK\n         sts_monobit|   1|    100000|     100|0.64468356|  PASSED</code></pre></div>\n<p>Compare with <a href=\"https://twitter.com/mikolasan/status/1610747223868051456\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">this homemade bitshift generator</a></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// By Tony Swain. all rights preservered. </span>\n<span class=\"token comment\">//Nevermind you can have it, but you can't sue me.</span>\n<span class=\"token comment\">// Actually just whipped it up for @Miklosan &amp; @Mathicino</span>\n<span class=\"token comment\">// **** Yet another random # generator. This one is designed for speed.</span>\n<span class=\"token comment\">// compile gcc -o lrand lrand.c</span>\n<span class=\"token comment\">// advantage; all done in inline and in register; zippidy do dah!</span>\n<span class=\"token comment\">// No implied warranty, Based on code by Leo Schwab written a bazillion years ago.</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdint.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;time.h></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">uint32_t</span> tRandomSeed<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">inline</span> <span class=\"token keyword\">uint32_t</span> <span class=\"token function\">lrand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    tRandomSeed <span class=\"token operator\">&lt;&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>tRandomSeed <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x80000000</span><span class=\"token punctuation\">)</span>\n        tRandomSeed <span class=\"token operator\">^=</span> <span class=\"token number\">0x80000000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n        tRandomSeed <span class=\"token operator\">^=</span> <span class=\"token number\">0x1D872B41</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> tRandomSeed<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n   time_t lt <span class=\"token operator\">=</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   tRandomSeed <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">uint32_t</span><span class=\"token punctuation\">)</span>lt<span class=\"token punctuation\">;</span> <span class=\"token comment\">// seed</span>\n\n   <span class=\"token keyword\">union</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">uint32_t</span> value<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">uint8_t</span> stream<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span> v<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">{</span>\n      v<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token function\">lrand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">{</span>\n         <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stdout</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%c\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token operator\">-</span>i<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; flex:0.5970695970695971;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f612db779f1d4e34c6f27e344bd30b6b/31be4/tony-rand-dieharder-1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 167.48466257668713%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAhABQDASIAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAEDAgQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAfiLTERrb0uCk07Dzg//xAAbEAACAgMBAAAAAAAAAAAAAAAAATFCEBEyQf/aAAgBAQABBQI8xQUPnQiohwf/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAWEAEBAQAAAAAAAAAAAAAAAAABECD/2gAIAQEABj8CpTRf/8QAHhAAAQQCAwEAAAAAAAAAAAAAAAEQETEhcUFhgaH/2gAIAQEAAT8h4Tsi2Wv0xT6BEDIjjYrK7l7f/9oADAMBAAIAAwAAABDQNA1//wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAgEBPxBr/8QAHRAAAwEAAgMBAAAAAAAAAAAAAAERITFBYZHwof/aAAgBAQABPxBdHYfb7ZRxuiqaVjUStFulp6OoSORmHkrT5Fj75GnuVnyeT9jFwf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"I ran &quot;dieharder&quot; tests on this RNG. It&#39;s not very convincing.\"\n        title=\"\"\n        src=\"/static/f612db779f1d4e34c6f27e344bd30b6b/6aca1/tony-rand-dieharder-1.jpg\"\n        srcset=\"/static/f612db779f1d4e34c6f27e344bd30b6b/d2f63/tony-rand-dieharder-1.jpg 163w,\n/static/f612db779f1d4e34c6f27e344bd30b6b/c989d/tony-rand-dieharder-1.jpg 325w,\n/static/f612db779f1d4e34c6f27e344bd30b6b/6aca1/tony-rand-dieharder-1.jpg 650w,\n/static/f612db779f1d4e34c6f27e344bd30b6b/31be4/tony-rand-dieharder-1.jpg 806w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 647px; flex:0.4808259587020649;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b0a728510c9a847b43db421cc2924bf/63577/tony-rand-dieharder-2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 207.9754601226994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAqABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB4dqjEA0pVGQg1qWsEh//xAAaEAADAAMBAAAAAAAAAAAAAAAAAUECMUIR/9oACAEBAAEFAuVtkW8jm5b58GSslZ//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAUEAEAAAAAAAAAAAAAAAAAAABA/9oACAEBAAY/Ahf/xAAdEAEBAAIDAAMAAAAAAAAAAAABABExIYGxQWHB/9oACAEBAAE/ISeBb9S5zvi+i2gp5IDtF/BHnqC5x0nzEfNtf//aAAwDAQACAAMAAAAQwMPD0M//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAWEQADAAAAAAAAAAAAAAAAAAAQESD/2gAIAQIBAT8QDj//xAAgEAACAgEEAwEAAAAAAAAAAAAAAREhcTFRsfAQQfFh/9oACAEBAAE/ENbJ+3yNPAgZFLvgJXCGOfdSrvbgEB7EO1FoUnK6LA+NegilZFRioEiYXk3Af//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;dieharder&quot; test results, part 2\"\n        title=\"\"\n        src=\"/static/7b0a728510c9a847b43db421cc2924bf/63577/tony-rand-dieharder-2.jpg\"\n        srcset=\"/static/7b0a728510c9a847b43db421cc2924bf/d2f63/tony-rand-dieharder-2.jpg 163w,\n/static/7b0a728510c9a847b43db421cc2924bf/c989d/tony-rand-dieharder-2.jpg 325w,\n/static/7b0a728510c9a847b43db421cc2924bf/63577/tony-rand-dieharder-2.jpg 647w\"\n        sizes=\"(max-width: 647px) 100vw, 647px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>test through file (when your engine is in javascript) <a href=\"https://gist.github.com/blixt/9abfafdd0ada0f4f6f26\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://gist.github.com/blixt/9abfafdd0ada0f4f6f26</a></li>\n<li>about results <a href=\"http://www.bitbabbler.org/test-data/dieharder.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">http://www.bitbabbler.org/test-data/dieharder.html</a></li>\n</ul>\n<h3 id=\"ent\" style=\"position:relative;\">ent<a href=\"#ent\" aria-label=\"ent permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p><a href=\"https://www.fourmilab.ch/random/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://www.fourmilab.ch/random/</a></p>\n<h2 id=\"about-prngs\" style=\"position:relative;\">About PRNGs<a href=\"#about-prngs\" aria-label=\"about prngs permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<h3 id=\"rand\" style=\"position:relative;\"><code class=\"language-text\">rand()</code><a href=\"#rand\" aria-label=\"rand permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<ul>\n<li>About rand() and modulo <a href=\"https://stackoverflow.com/questions/10984974/why-do-people-say-there-is-modulo-bias-when-using-a-random-number-generator\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/10984974/why-do-people-say-there-is-modulo-bias-when-using-a-random-number-generator</a></li>\n<li>How much bias is introduced by the remainder technique? <a href=\"https://ericlippert.com/2013/12/16/how-much-bias-is-introduced-by-the-remainder-technique/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://ericlippert.com/2013/12/16/how-much-bias-is-introduced-by-the-remainder-technique/</a></li>\n<li>Bias in C# random <a href=\"https://fuglede.dk/en/blog/bias-in-net-rng/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://fuglede.dk/en/blog/bias-in-net-rng/</a></li>\n<li>All scary stories about rand() is in the past, because (at least on Linux) <code class=\"language-text\">RAND_MAX</code> is 2147483647. Check it for yourself <a href=\"https://en.cppreference.com/w/c/numeric/random/rand\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://en.cppreference.com/w/c/numeric/random/rand</a></li>\n<li>RNG in every language <a href=\"https://rosettacode.org/wiki/Random_number_generator_(included)\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://rosettacode.org/wiki/Random_number_generator_(included)</a></li>\n</ul>\n<h3 id=\"mersenne-twister\" style=\"position:relative;\">Mersenne Twister<a href=\"#mersenne-twister\" aria-label=\"mersenne twister permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p>Mersenne Twister is very predictable. <a href=\"https://cryptopals.com/sets/3/challenges/23\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Here</a> some steps to get it reversed.</p>\n<h3 id=\"isaac\" style=\"position:relative;\">ISAAC<a href=\"#isaac\" aria-label=\"isaac permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p><a href=\"http://burtleburtle.net/bob/rand/isaacafa.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">The official page</a>.</p>\n<p><a href=\"https://eprint.iacr.org/2006/438.pdf\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Review</a> of weak starting points.</p>\n<h2 id=\"statistical-tests\" style=\"position:relative;\">Statistical tests<a href=\"#statistical-tests\" aria-label=\"statistical tests permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>We are working with discrete uniform distribution (not continuous!) <a href=\"https://en.wikipedia.org/wiki/Discrete_uniform_distribution\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://en.wikipedia.org/wiki/Discrete_uniform_distribution</a>. Kolmogorov-Smirnov test works only with  continuous distributions, so we have to use Chi-Square</p>\n<h3 id=\"chi-square-test\" style=\"position:relative;\">Chi-Square test<a href=\"#chi-square-test\" aria-label=\"chi square test permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<ul>\n<li>Chi-Square Goodness-of-Fit Test <a href=\"https://www.itl.nist.gov/div898/handbook/eda/section3/eda35f.htm\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://www.itl.nist.gov/div898/handbook/eda/section3/eda35f.htm</a></li>\n<li>critical values <a href=\"https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm</a></li>\n<li><a href=\"https://stats.stackexchange.com/questions/408861/did-i-do-this-chi2-test-for-discrete-uniform-distribution-correctly\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stats.stackexchange.com/questions/408861/did-i-do-this-chi2-test-for-discrete-uniform-distribution-correctly</a></li>\n<li><a href=\"https://stats.stackexchange.com/questions/502719/testing-uniform-distribution-of-a-discrete-function-derived-from-a-random-number\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stats.stackexchange.com/questions/502719/testing-uniform-distribution-of-a-discrete-function-derived-from-a-random-number</a></li>\n<li>ELI5 tutorial <a href=\"https://www.mathsisfun.com/data/chi-square-test.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://www.mathsisfun.com/data/chi-square-test.html</a></li>\n<li>calculator code <a href=\"https://www.codeproject.com/Articles/432194/How-to-Calculate-the-Chi-Squared-P-Value\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://www.codeproject.com/Articles/432194/How-to-Calculate-the-Chi-Squared-P-Value</a></li>\n</ul>\n<h3 id=\"kolmogorov-smirnov-test\" style=\"position:relative;\">Kolmogorov-Smirnov test<a href=\"#kolmogorov-smirnov-test\" aria-label=\"kolmogorov smirnov test permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<ul>\n<li><a href=\"https://daithiocrualaoich.github.io/kolmogorov_smirnov/\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://daithiocrualaoich.github.io/kolmogorov_smirnov/</a></li>\n<li><a href=\"https://stackoverflow.com/questions/37625280/kolmogorov-smrinov-test-in-c\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://stackoverflow.com/questions/37625280/kolmogorov-smrinov-test-in-c</a></li>\n<li>Biased into random: <a href=\"https://towardsdatascience.com/how-to-get-an-unbiased-rng-from-an-unbalanced-one-dbb44850e5f7\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://towardsdatascience.com/how-to-get-an-unbiased-rng-from-an-unbalanced-one-dbb44850e5f7</a></li>\n<li>how scientists prove that prng is biased <a href=\"https://arxiv.org/pdf/math/0603058.pdf\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://arxiv.org/pdf/math/0603058.pdf</a></li>\n<li>test pairs <a href=\"https://math.stackexchange.com/questions/357672/density-of-sum-of-two-independent-uniform-random-variables-on-0-1\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">https://math.stackexchange.com/questions/357672/density-of-sum-of-two-independent-uniform-random-variables-on-0-1</a></li>\n</ul>\n<h3 id=\"boost\" style=\"position:relative;\">Boost<a href=\"#boost\" aria-label=\"boost permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h3>\n<p>For quantiles <a href=\"https://valelab4.ucsf.edu/svn/3rdpartypublic/boost/libs/math/doc/sf_and_dist/html/math_toolkit/dist/stat_tut/weg/cs_eg/chi_sq_test.html\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">use boost</a>. Include it with cmake in <a href=\"https://stackoverflow.com/questions/3897839/how-to-link-c-program-with-boost-using-cmake\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">this way</a>. <a href=\"https://stackoverflow.com/a/31293908/1104612\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Strip the boost</a> later.</p>\n<h2 id=\"scaling-and-cryptographic-strength\" style=\"position:relative;\">Scaling and cryptographic strength<a href=\"#scaling-and-cryptographic-strength\" aria-label=\"scaling and cryptographic strength permalink\" class=\"with-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\">\n                <path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3\n                3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3\n                  9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64\n                  1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\">\n                </path>\n                </svg></a></h2>\n<p>from <a href=\"https://arxiv.org/pdf/1910.06437\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\">Flaws of MT PRNG</a></p>\n<blockquote>\n<p>(d) The scaling method may not compromise the cryptographic strength of the random number generator. The scaling method must preserve the distribution of the scaled values. For example, if a 32-bit random number generator with a range of the set of integers in the closed interval (0, 232-1) were to be scaled to the range of the set of integers in the closed interval (1, 6) so that the scaled values can be used to simulate the roll of a standard six-sided die, then each integer in the scaled range should theoretically appear with equal frequency. In the example given, if the theoretical frequency for each value is not equal, then the scaling method <strong>is considered to have a bias</strong>. Thus, a compliant scaling method must have bias equal to zero</p>\n</blockquote>","excerpt":"Biased scaling First things first. How to find a bias in random number generator? But not that bias that all statistical tests search for in…","tableOfContents":"<ul>\n<li>\n<p><a href=\"#biased-scaling\">Biased scaling</a></p>\n<ul>\n<li><a href=\"#reference\">Reference</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#plot-the-error\">Plot the error</a></p>\n</li>\n<li>\n<p><a href=\"#test-suites\">Test suites</a></p>\n<ul>\n<li><a href=\"#testu01--bigcrush\">TestU01 / BigCrush</a></li>\n<li><a href=\"#dieharder\">Dieharder</a></li>\n<li><a href=\"#ent\">ent</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#about-prngs\">About PRNGs</a></p>\n<ul>\n<li><a href=\"#rand\"><code class=\"language-text\">rand()</code></a></li>\n<li><a href=\"#mersenne-twister\">Mersenne Twister</a></li>\n<li><a href=\"#isaac\">ISAAC</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#statistical-tests\">Statistical tests</a></p>\n<ul>\n<li><a href=\"#chi-square-test\">Chi-Square test</a></li>\n<li><a href=\"#kolmogorov-smirnov-test\">Kolmogorov-Smirnov test</a></li>\n<li><a href=\"#boost\">Boost</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#scaling-and-cryptographic-strength\">Scaling and cryptographic strength</a></p>\n</li>\n</ul>","fields":{"socialcard":"gatsby-plugin-social-card/f3f2910d-1c45-5163-ae70-10d64eeb983a.jpg"},"frontmatter":{"date":"December 22, 2022","published":"December 25, 2022","lastModified":"June 04, 2023","title":"Finding bias in PRNG","subtitle":null,"section":null,"draft":null,"developing":null,"buttonText":null,"buttonLink":null,"secondButtonText":null,"secondButtonLink":null,"featuredImage":null}}},"pageContext":{"showLikes":true,"absolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/finding-bias-in-prng.md","url":"/code/finding-bias-in-prng","next":{"excerpt":"What the result of this code will be? Answer The output of this program will be a rectangular grid of ASCII characters, where each character…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/elegant-c-code.md","frontmatter":{"title":"Elegant C code","date":"2022-12-24T00:00:00.000Z","topic":null,"article":null},"id":"1f674723-2efd-558c-bb3d-a5afad121ee9"},"previous":{"excerpt":"If you have started using git years ago, then you already have habits and your preferred ways of doing things. But new versions introduce…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/git-tips-for-old-dogs.md","frontmatter":{"title":"Git tips for old dogs","date":"2022-09-18T00:00:00.000Z","topic":null,"article":null},"id":"ef1ed0ed-740b-59f3-a352-b02e38b244ac"},"recentArticles":[{"excerpt":"Then here is the list of alternatives Intel-IPP Links: https://software.intel.com/en-us/intel-ipp , https://github.com/intel/ipp-crypto…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/if-you-hate-openssl.md","frontmatter":{"title":"If you hate OpenSSL","date":"2024-05-10T00:00:00.000Z","topic":null,"article":null},"id":"0c36d8cc-31d2-582b-9929-51cf8bed8920"},{"excerpt":"cool thing for the background (play it together with egzod - royalty) nice globe  Cool WebGL examples (no code, sad)","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/webgl.md","frontmatter":{"title":"WebGL","date":"2023-07-17T00:00:00.000Z","topic":null,"article":null},"id":"1bbe4c4e-2cc1-5fec-a2ca-b8cefdbfc6ee"},{"excerpt":"Check that you have ESLint extension installed. (Optional) While you are playing with linters and VS Code extensions, you can think about a…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/eslint-for-gatsby-howto.md","frontmatter":{"title":"ESLint in VS Code for Gatsby 5 blog","date":"2023-05-29T00:00:00.000Z","topic":null,"article":null},"id":"5953c80a-01e6-56c1-985e-bb9c0b1f340b"},{"excerpt":"The reason behind \"connect, disconnect and then connect again\" behavior might be that the old socket was still listening because it was half…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/how-to-close-tcp-socket-in-nodejs.md","frontmatter":{"title":"How to close TCP socket in Node.js","date":"2023-02-02T00:00:00.000Z","topic":null,"article":null},"id":"e7b7740f-e7b4-565f-a843-05bf8c27fda3"},{"excerpt":"When does verification happen? From this wiki it seems like the get function does it. What security level to use? https://www.openssl.org…","fileAbsolutePath":"/home/runner/work/mikolasan.github.io/mikolasan.github.io/src/markdown/code/ssl-tls-client-socket-with-openssl.md","frontmatter":{"title":"SSL/TLS client socket with OpenSSL","date":"2023-01-26T00:00:00.000Z","topic":null,"article":null},"id":"1f2b456a-3ea6-5863-a966-8579f11b39bd"}]}},"staticQueryHashes":["2961657013","447685113"],"slicesMap":{}}